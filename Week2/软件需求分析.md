# 软件需求分析

## 首部

### 项目信息

- **项目名称**: Go语言书城项目

- **项目标识**: GOBOOKSTORE-2025-001

- **版本**: V1.0

### 状态与版本信息

- **文件状态**: 草稿

- **文件标识**: SC-GOBOOKSTORE-V1.0-ProgramAnlayz

- **当前版本**: V1.0

- **作者**:
  
  - **姓名**: 陈泓瑞
  
  - **学号**: 2022011153
  
  - **姓名**: 
  
  - **学号**: 
  
  - **姓名**: 
  
  - **学号**: 
  
  - **姓名**: 
  
  - **学号**: 
  
  - **团队**:404回收站
 
   ## 3 服务端模块需求说明
  ### 3.1 首页

#### 3.1.1 首页页面数据项
| 数据项名称       | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|------------------|----------|----------|---------------------------------|------------------------------------------|
| 图书 ID          | INT      | 是       | 1001                            | 图书唯一标识，用于关联图书详情、购物车操作等 |
| 图书封面         | STRING   | 是       | "/static/img/three_kingdoms.jpg" | 图书封面图片路径，展示图书外观           |
| 图书名称         | STRING   | 是       | "三国演义"                      | 图书标题，用于用户识别图书               |
| 图书作者         | STRING   | 是       | "罗贯中"                        | 图书作者信息                             |
| 图书价格         | FLOAT    | 是       | 88.88                           | 图书售价，保留两位小数                   |
| 图书销量         | INT      | 是       | 100                             | 图书累计销售数量，用于展示热门程度       |
| 图书库存         | INT      | 是       | 50                              | 图书当前库存数量，库存为 0 时显示 “补货中” |
| 价格筛选下限     | FLOAT    | 否       | 50                              | 用户输入的价格筛选最小值，为空时不限制下限 |
| 价格筛选上限     | FLOAT    | 否       | 100                             | 用户输入的价格筛选最大值，为空时不限制上限 |
| 当前页码         | INT      | 是       | 2                              | 分页导航中的当前页码，默认从 1 开始       |
| 总页数           | INT      | 是       | 5                              | 符合条件的图书总页数，由总记录数和每页显示条数计算得出 |
| 总记录数         | INT      | 是       | 20                             | 符合条件的图书总数量                     |
| 登录状态         | BOOLEAN  | 是       | true                           | 标识用户是否登录（true 为已登录，false 为未登录），控制 “加入购物车” 按钮状态 |


#### 3.1.2 首页功能用例分析

1. **用例名称：图书列表展示与分页**  
   用例编号：UC-1.1  
   参与者：主参与者：用户、管理员  
   触发条件：用户访问首页或切换分页页码  
   前置条件：系统已加载图书数据  
   主要流程：  
   1. 系统接收用户请求（默认首页或指定页码）；  
   2. 系统调用`GetPageBooks`或`GetPageBooksByPrice`接口查询对应页码的图书数据；  
   3. 系统计算总页数、总记录数并返回分页信息；  
   4. 页面渲染图书列表（包含封面、名称、作者等信息）及分页导航；  
   5. 分页导航显示 “首页、上一页、下一页、末页” 及页码输入框。  
   后置条件：用户成功查看对应页码的图书列表  
   异常情况：  
   - 数据库查询失败：页面显示 “暂无图书数据” 提示；  
   - 用户输入无效页码（如负数或超过总页数）：系统自动跳转至首页。  


2. **用例名称：价格范围筛选图书**  
   用例编号：UC-1.2  
   参与者：主参与者：用户  
   触发条件：用户输入价格区间并提交筛选  
   前置条件：用户已进入首页  
   主要流程：  
   1. 用户在价格筛选表单中输入下限和 / 或上限价格；  
   2. 点击 “筛选” 按钮提交请求；  
   3. 系统调用`GetPageBooksByPrice`接口查询符合价格条件的图书；  
   4. 页面重新渲染符合条件的图书列表及分页信息。  
   后置条件：用户成功查看符合价格条件的图书  
   异常情况：  
   - 输入价格格式错误（如非数字）：系统提示 “请输入有效的价格”；  
   - 无符合条件的图书：页面显示 “未找到符合条件的图书”。  


3. **用例名称：添加图书到购物车**  
   用例编号：UC-1.3  
   参与者：主参与者：已登录用户；次要参与者：未登录用户  
   触发条件：用户点击图书的 “加入购物车” 按钮  
   前置条件：图书库存 > 0  
   主要流程：  
   1. 系统检测用户登录状态（通过`IsLogin`接口验证）；  
   2. 若已登录：  
      - 调用`AddBook2Cart`接口将图书添加到用户购物车（已存在则更新数量，不存在则创建购物项）；  
      - 页面显示 “添加成功” 提示；  
   3. 若未登录：  
      - 页面显示 “请先登录” 提示。  
   后置条件：已登录用户的购物车中成功添加对应图书  
   异常情况：  
   - 图书库存不足：按钮置灰并提示 “库存不足”；  
   - 购物车添加失败（如数据库错误）：页面显示 “添加失败，请重试”。  


4. **用例名称：库存状态展示**  
   用例编号：UC-1.4  
   参与者：主参与者：用户  
   触发条件：图书列表加载完成  
   前置条件：系统已获取图书库存数据  
   主要流程：  
   1. 系统遍历图书列表，检查每本图书的库存数量；  
   2. 若库存 > 0：显示 “加入购物车” 按钮（可点击）；  
   3. 若库存 = 0：显示 “补货中” 提示（按钮隐藏或置灰）。  
   后置条件：用户清晰识别图书库存状态  
   异常情况：  
   - 库存数据查询异常：默认显示 “库存未知” 提示。

### 3.2图书管理页

#### 3.2.1页面数据项
| 数据项名称   | 数据类型   | 是否必填 | 示例值                          | 说明                                                                 |
|--------------|------------|----------|---------------------------------|----------------------------------------------------------------------|
| 图书ID       | INT        | 是       | 1001                            | 图书唯一标识，用于编辑、删除操作的参数传递                         |
| 图书名称     | STRING     | 是       | "三国演义"                      | 图书标题，展示在列表中                                               |
| 图书作者     | STRING     | 是       | "罗贯中"                        | 图书作者信息                                                         |
| 图书价格     | FLOAT      | 是       | 88.88                           | 图书售价，保留两位小数                                               |
| 图书销量     | INT        | 是       | 100                             | 图书累计销售数量                                                     |
| 图书库存     | INT        | 是       | 50                              | 图书当前库存数量                                                     |
| 当前页码     | INT        | 是       | 2                              | 分页导航中的当前页码，默认从1开始                                   |
| 总页数       | INT        | 是       | 5                              | 符合条件的图书总页数，由总记录数和每页显示条数计算得出               |
| 总记录数     | INT        | 是       | 20                             | 符合条件的图书总数量                                                 |

### 3.2.2图书管理页功能点用例分析

1. #### 用例名称：图书列表分页展示
- **用例编号**：UC-2.1  
- **参与者**：管理员  
- **触发条件**：管理员访问图书管理页，或通过分页控件切换页码（如点击“上一页”“下一页”、输入页码并确认）  
- **前置条件**：系统已连接数据库且存在图书数据  
- **主要流程**：  
  1. 系统接收页面请求（默认加载第1页，或携带指定页码参数）；  
  2. 调用`GetPageBooks`接口，根据页码计算分页偏移量（每页默认显示4条记录）；  
  3. 从数据库查询对应页的图书数据（包含ID、名称、价格、作者、销量、库存等信息）；  
  4. 计算总记录数和总页数，生成分页信息（当前页、总页数、是否有上一页/下一页等）；  
  5. 页面渲染图书列表表格及分页控件（首页、上一页、下一页、末页按钮和页码输入框）。  
- **后置条件**：管理员成功查看对应页码的图书列表  
- **异常情况**：  
  1. 数据库查询失败：页面显示空列表，无图书数据；  
  2. 输入无效页码（如负数或大于总页数）：系统自动跳转至第1页。  


2. #### 用例名称：图书删除操作
- **用例编号**：UC-2.2  
- **参与者**：管理员  
- **触发条件**：管理员点击某本图书后的“删除”按钮  
- **前置条件**：待删除图书存在于数据库中  
- **主要流程**：  
  1. 点击“删除”按钮时，系统弹出确认弹窗（显示图书名称，提示“确定要删除【xxx】这本图书吗？”）；  
  2. 管理员确认删除后，系统获取该图书的ID并调用`DeleteBook`接口；  
  3. 接口执行数据库删除操作，移除该图书记录；  
  4. 页面重新加载当前页的图书列表（若删除后当前页无数据，自动跳转至上一页）。  
- **后置条件**：图书从数据库中移除，列表中不再显示该图书  
- **异常情况**：  
  1. 数据库删除失败：页面不刷新，图书仍显示在列表中；  
  2. 管理员取消确认：删除操作终止，列表无变化。  


3. #### 用例名称：图书编辑操作
- **用例编号**：UC-2.3  
- **参与者**：管理员  
- **触发条件**：管理员点击某本图书后的“修改”按钮  
- **前置条件**：待编辑图书存在于数据库中  
- **主要流程**：  
  1. 点击“修改”按钮后，系统携带图书ID跳转至`toUpdateBookPage`接口；  
  2. 接口查询该图书的详细信息（名称、价格、作者、销量、库存等）；  
  3. 页面跳转至`book_edit.html`，表单预填充图书当前信息；  
  4. 管理员修改表单数据后点击“提交”，系统调用`updateOraddBook`接口；  
  5. 接口执行数据库更新操作，保存修改后的图书信息；  
  6. 操作完成后跳转回图书管理页，列表显示更新后的图书数据。  
- **后置条件**：图书信息更新至数据库，列表同步刷新  
- **异常情况**：  
  1. 输入数据格式错误（如价格为非数字）：接口未执行更新，页面无提示（需补充前端校验）；  
  2. 数据库更新失败：图书信息未变更，页面仍显示旧数据。  


4. #### 用例名称：图书添加操作
- **用例编号**：UC-2.4  
- **参与者**：管理员  
- **触发条件**：管理员点击图书列表底部的“添加图书”链接  
- **前置条件**：管理员已进入图书管理页  
- **主要流程**：  
  1. 点击“添加图书”后，系统跳转至`toUpdateBookPage`接口（无图书ID参数）；  
  2. 页面加载`book_edit.html`，显示空表单（包含名称、价格、作者、销量、库存输入框）；  
  3. 管理员填写表单信息后点击“提交”，系统调用`updateOraddBook`接口；  
  4. 接口执行数据库插入操作，创建新图书记录（默认封面图路径为`/static/img/default.jpg`）；  
  5. 操作完成后跳转回图书管理页，列表显示新添加的图书。  
- **后置条件**：新图书被添加至数据库，列表中新增该图书记录  
- **异常情况**：  
  1. 输入数据不完整（如未填写书名）：接口未执行插入，页面无提示（需补充前端校验）；  
  2. 数据库插入失败：无新图书记录生成，列表无变化。  


5. #### 用例名称：管理员权限控制
- **用例编号**：UC-2.5  
- **参与者**：系统、管理员、普通用户  
- **触发条件**：用户访问图书管理页（通过`/getPageBooks`路由）  
- **前置条件**：系统已实现用户身份验证逻辑  
- **主要流程**：  
  1. 系统通过会话（Session）判断访问者身份；  
  2. 若为管理员：允许访问`getPageBooks`接口，返回图书列表及管理功能页面；  
  3. 若为普通用户或未登录用户：系统拦截请求，可能跳转至登录页或拒绝访问（当前代码未明确实现，需结合权限逻辑补充）。  
- **后置条件**：管理员正常使用图书管理功能，非管理员被限制访问  
- **异常情况**：  
  1. 权限判断逻辑异常：非管理员可能绕过验证访问管理页；  
  2. 会话失效：管理员需重新登录后才能访问。
