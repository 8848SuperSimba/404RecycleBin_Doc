# 软件需求分析

## 首部

### 项目信息

- **项目名称**: Go语言书城项目

- **项目标识**: GOBOOKSTORE-2025-001

- **版本**: V1.0

### 状态与版本信息

- **文件状态**: 草稿

- **文件标识**: SC-GOBOOKSTORE-V1.0-ProgramAnlayz

- **当前版本**: V1.0

- **作者**:
  
  - **姓名**: 陈泓瑞
  
  - **学号**: 2022011153
  
  - **姓名**: 
  
  - **学号**: 
  
  - **姓名**: 
  
  - **学号**: 
  
  - **姓名**: 傅宇驰
  
  - **学号**: 2022011127
  
  - **团队**:404回收站
 
   ## 3 服务端模块需求说明
  ### 3.1 首页

#### 3.1.1 首页页面数据项
| 数据项名称       | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|------------------|----------|----------|---------------------------------|------------------------------------------|
| 图书 ID          | INT      | 是       | 1001                            | 图书唯一标识，用于关联图书详情、购物车操作等 |
| 图书封面         | STRING   | 是       | "/static/img/three_kingdoms.jpg" | 图书封面图片路径，展示图书外观           |
| 图书名称         | STRING   | 是       | "三国演义"                      | 图书标题，用于用户识别图书               |
| 图书作者         | STRING   | 是       | "罗贯中"                        | 图书作者信息                             |
| 图书价格         | FLOAT    | 是       | 88.88                           | 图书售价，保留两位小数                   |
| 图书销量         | INT      | 是       | 100                             | 图书累计销售数量，用于展示热门程度       |
| 图书库存         | INT      | 是       | 50                              | 图书当前库存数量，库存为 0 时显示 “补货中” |
| 价格筛选下限     | FLOAT    | 否       | 50                              | 用户输入的价格筛选最小值，为空时不限制下限 |
| 价格筛选上限     | FLOAT    | 否       | 100                             | 用户输入的价格筛选最大值，为空时不限制上限 |
| 当前页码         | INT      | 是       | 2                              | 分页导航中的当前页码，默认从 1 开始       |
| 总页数           | INT      | 是       | 5                              | 符合条件的图书总页数，由总记录数和每页显示条数计算得出 |
| 总记录数         | INT      | 是       | 20                             | 符合条件的图书总数量                     |
| 登录状态         | BOOLEAN  | 是       | true                           | 标识用户是否登录（true 为已登录，false 为未登录），控制 “加入购物车” 按钮状态 |


#### 3.1.2 首页功能用例分析

1. **用例名称：图书列表展示与分页**  
   用例编号：UC-1.1  
   参与者：主参与者：用户、管理员  
   触发条件：用户访问首页或切换分页页码  
   前置条件：系统已加载图书数据  
   主要流程：  
   1. 系统接收用户请求（默认首页或指定页码）；  
   2. 系统调用`GetPageBooks`或`GetPageBooksByPrice`接口查询对应页码的图书数据；  
   3. 系统计算总页数、总记录数并返回分页信息；  
   4. 页面渲染图书列表（包含封面、名称、作者等信息）及分页导航；  
   5. 分页导航显示 “首页、上一页、下一页、末页” 及页码输入框。  
   后置条件：用户成功查看对应页码的图书列表  
   异常情况：  
   - 数据库查询失败：页面显示 “暂无图书数据” 提示；  
   - 用户输入无效页码（如负数或超过总页数）：系统自动跳转至首页。  


2. **用例名称：价格范围筛选图书**  
   用例编号：UC-1.2  
   参与者：主参与者：用户  
   触发条件：用户输入价格区间并提交筛选  
   前置条件：用户已进入首页  
   主要流程：  
   1. 用户在价格筛选表单中输入下限和 / 或上限价格；  
   2. 点击 “筛选” 按钮提交请求；  
   3. 系统调用`GetPageBooksByPrice`接口查询符合价格条件的图书；  
   4. 页面重新渲染符合条件的图书列表及分页信息。  
   后置条件：用户成功查看符合价格条件的图书  
   异常情况：  
   - 输入价格格式错误（如非数字）：系统提示 “请输入有效的价格”；  
   - 无符合条件的图书：页面显示 “未找到符合条件的图书”。  


3. **用例名称：添加图书到购物车**  
   用例编号：UC-1.3  
   参与者：主参与者：已登录用户；次要参与者：未登录用户  
   触发条件：用户点击图书的 “加入购物车” 按钮  
   前置条件：图书库存 > 0  
   主要流程：  
   1. 系统检测用户登录状态（通过`IsLogin`接口验证）；  
   2. 若已登录：  
      - 调用`AddBook2Cart`接口将图书添加到用户购物车（已存在则更新数量，不存在则创建购物项）；  
      - 页面显示 “添加成功” 提示；  
   3. 若未登录：  
      - 页面显示 “请先登录” 提示。  
   后置条件：已登录用户的购物车中成功添加对应图书  
   异常情况：  
   - 图书库存不足：按钮置灰并提示 “库存不足”；  
   - 购物车添加失败（如数据库错误）：页面显示 “添加失败，请重试”。  


4. **用例名称：库存状态展示**  
   用例编号：UC-1.4  
   参与者：主参与者：用户  
   触发条件：图书列表加载完成  
   前置条件：系统已获取图书库存数据  
   主要流程：  
   1. 系统遍历图书列表，检查每本图书的库存数量；  
   2. 若库存 > 0：显示 “加入购物车” 按钮（可点击）；  
   3. 若库存 = 0：显示 “补货中” 提示（按钮隐藏或置灰）。  
   后置条件：用户清晰识别图书库存状态  
   异常情况：  
   - 库存数据查询异常：默认显示 “库存未知” 提示。

### 3.2图书管理页

#### 3.2.1页面数据项
| 数据项名称   | 数据类型   | 是否必填 | 示例值                          | 说明                                                                 |
|--------------|------------|----------|---------------------------------|----------------------------------------------------------------------|
| 图书ID       | INT        | 是       | 1001                            | 图书唯一标识，用于编辑、删除操作的参数传递                         |
| 图书名称     | STRING     | 是       | "三国演义"                      | 图书标题，展示在列表中                                               |
| 图书作者     | STRING     | 是       | "罗贯中"                        | 图书作者信息                                                         |
| 图书价格     | FLOAT      | 是       | 88.88                           | 图书售价，保留两位小数                                               |
| 图书销量     | INT        | 是       | 100                             | 图书累计销售数量                                                     |
| 图书库存     | INT        | 是       | 50                              | 图书当前库存数量                                                     |
| 当前页码     | INT        | 是       | 2                              | 分页导航中的当前页码，默认从1开始                                   |
| 总页数       | INT        | 是       | 5                              | 符合条件的图书总页数，由总记录数和每页显示条数计算得出               |
| 总记录数     | INT        | 是       | 20                             | 符合条件的图书总数量                                                 |

### 3.2.2图书管理页功能点用例分析

1. #### 用例名称：图书列表分页展示
- **用例编号**：UC-2.1  
- **参与者**：管理员  
- **触发条件**：管理员访问图书管理页，或通过分页控件切换页码（如点击“上一页”“下一页”、输入页码并确认）  
- **前置条件**：系统已连接数据库且存在图书数据  
- **主要流程**：  
  1. 系统接收页面请求（默认加载第1页，或携带指定页码参数）；  
  2. 调用`GetPageBooks`接口，根据页码计算分页偏移量（每页默认显示4条记录）；  
  3. 从数据库查询对应页的图书数据（包含ID、名称、价格、作者、销量、库存等信息）；  
  4. 计算总记录数和总页数，生成分页信息（当前页、总页数、是否有上一页/下一页等）；  
  5. 页面渲染图书列表表格及分页控件（首页、上一页、下一页、末页按钮和页码输入框）。  
- **后置条件**：管理员成功查看对应页码的图书列表  
- **异常情况**：  
  1. 数据库查询失败：页面显示空列表，无图书数据；  
  2. 输入无效页码（如负数或大于总页数）：系统自动跳转至第1页。  


2. #### 用例名称：图书删除操作
- **用例编号**：UC-2.2  
- **参与者**：管理员  
- **触发条件**：管理员点击某本图书后的“删除”按钮  
- **前置条件**：待删除图书存在于数据库中  
- **主要流程**：  
  1. 点击“删除”按钮时，系统弹出确认弹窗（显示图书名称，提示“确定要删除【xxx】这本图书吗？”）；  
  2. 管理员确认删除后，系统获取该图书的ID并调用`DeleteBook`接口；  
  3. 接口执行数据库删除操作，移除该图书记录；  
  4. 页面重新加载当前页的图书列表（若删除后当前页无数据，自动跳转至上一页）。  
- **后置条件**：图书从数据库中移除，列表中不再显示该图书  
- **异常情况**：  
  1. 数据库删除失败：页面不刷新，图书仍显示在列表中；  
  2. 管理员取消确认：删除操作终止，列表无变化。  


3. #### 用例名称：图书编辑操作
- **用例编号**：UC-2.3  
- **参与者**：管理员  
- **触发条件**：管理员点击某本图书后的“修改”按钮  
- **前置条件**：待编辑图书存在于数据库中  
- **主要流程**：  
  1. 点击“修改”按钮后，系统携带图书ID跳转至`toUpdateBookPage`接口；  
  2. 接口查询该图书的详细信息（名称、价格、作者、销量、库存等）；  
  3. 页面跳转至`book_edit.html`，表单预填充图书当前信息；  
  4. 管理员修改表单数据后点击“提交”，系统调用`updateOraddBook`接口；  
  5. 接口执行数据库更新操作，保存修改后的图书信息；  
  6. 操作完成后跳转回图书管理页，列表显示更新后的图书数据。  
- **后置条件**：图书信息更新至数据库，列表同步刷新  
- **异常情况**：  
  1. 输入数据格式错误（如价格为非数字）：接口未执行更新，页面无提示（需补充前端校验）；  
  2. 数据库更新失败：图书信息未变更，页面仍显示旧数据。  


4. #### 用例名称：图书添加操作
- **用例编号**：UC-2.4  
- **参与者**：管理员  
- **触发条件**：管理员点击图书列表底部的“添加图书”链接  
- **前置条件**：管理员已进入图书管理页  
- **主要流程**：  
  1. 点击“添加图书”后，系统跳转至`toUpdateBookPage`接口（无图书ID参数）；  
  2. 页面加载`book_edit.html`，显示空表单（包含名称、价格、作者、销量、库存输入框）；  
  3. 管理员填写表单信息后点击“提交”，系统调用`updateOraddBook`接口；  
  4. 接口执行数据库插入操作，创建新图书记录（默认封面图路径为`/static/img/default.jpg`）；  
  5. 操作完成后跳转回图书管理页，列表显示新添加的图书。  
- **后置条件**：新图书被添加至数据库，列表中新增该图书记录  
- **异常情况**：  
  1. 输入数据不完整（如未填写书名）：接口未执行插入，页面无提示（需补充前端校验）；  
  2. 数据库插入失败：无新图书记录生成，列表无变化。  


5. #### 用例名称：管理员权限控制
- **用例编号**：UC-2.5  
- **参与者**：系统、管理员、普通用户  
- **触发条件**：用户访问图书管理页（通过`/getPageBooks`路由）  
- **前置条件**：系统已实现用户身份验证逻辑  
- **主要流程**：  
  1. 系统通过会话（Session）判断访问者身份；  
  2. 若为管理员：允许访问`getPageBooks`接口，返回图书列表及管理功能页面；  
  3. 若为普通用户或未登录用户：系统拦截请求，可能跳转至登录页或拒绝访问（当前代码未明确实现，需结合权限逻辑补充）。  
- **后置条件**：管理员正常使用图书管理功能，非管理员被限制访问  
- **异常情况**：  
  1. 权限判断逻辑异常：非管理员可能绕过验证访问管理页；  
  2. 会话失效：管理员需重新登录后才能访问。

## 3.7 管理员首页模块需求说明
### 3.7.1 管理员首页页面数据项
| 数据项名称         | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|--------------------|----------|----------|---------------------------------|------------------------------------------|
| 图书总数           | INT      | 是       | 200                             | 系统中所有图书的总数量，从数据库统计得出 |
| 待发货订单数       | INT      | 是       | 15                              | 状态为“未发货”的订单总数量               |
| 今日新增用户数     | INT      | 是       | 8                               | 当天注册的用户总数量                     |
| 本周销售额         | FLOAT    | 是       | 5000.50                         | 本周累计销售总金额，保留两位小数         |
| 热门图书TOP3列表   | 数组     | 是       | [{"id":101,"title":"三体"},...] | 按销量排序的前三名图书信息，含ID、名称、销量 |
| 管理员登录状态     | BOOLEAN  | 是       | true                           | 标识管理员是否登录（true为已登录，false为未登录），控制页面访问权限 |
| 会话有效期         | INT      | 是       | 30                              | 管理员登录会话的有效时长（分钟），超时自动退出 |
| 最近登录时间       | STRING   | 是       | "2024-06-12 09:30:25"          | 管理员上次登录的时间，用于安全提示       |
| 系统当前时间       | STRING   | 是       | "2024-06-12 15:45:30"          | 服务器当前时间，用于数据时效性展示       |
| 操作日志条数       | INT      | 否       | 23                              | 今日管理员操作日志的总条数，可选展示     |

### 3.7.2 管理员首页功能用例分析

1. **用例名称：管理员权限验证**  
   用例编号：UC-3.7.1  
   参与者：主参与者：管理员；次要参与者：普通用户、未登录用户  
   触发条件：用户访问管理员首页  
   前置条件：系统已配置管理员角色权限  
   主要流程：  
   1. 系统接收管理员首页访问请求；  
   2. 调用`IsLogin`接口验证用户登录状态及角色（`role=admin`）；  
   3. 若为管理员且已登录：允许访问并加载页面数据；  
   4. 若为普通用户或未登录：自动跳转至登录页并提示“权限不足，请使用管理员账号登录”。  
   后置条件：管理员成功访问首页，非管理员被拒绝访问  
   异常情况：  
   - 会话验证失败（如Session过期）：跳转至登录页并提示“登录已过期，请重新登录”；  
   - 角色信息异常（如角色字段为空）：记录错误日志并拒绝访问。  


2. **用例名称：核心数据概览展示**  
   用例编号：UC-3.7.2  
   参与者：主参与者：管理员  
   触发条件：管理员成功访问首页或页面定时刷新  
   前置条件：管理员已登录且权限验证通过  
   主要流程：  
   1. 系统调用统计接口（如`/getAdminStats`）查询图书总数、待发货订单数、今日新增用户数、本周销售额等核心数据；  
   2. 页面以卡片形式展示各类数据，不同数据对应不同颜色标识（如销售额用绿色，待发货订单用橙色）；  
   3. 热门图书TOP3以列表形式展示，包含图书封面缩略图、名称及销量；  
   4. 每30秒自动重新请求接口刷新数据，更新时显示淡入动画提示“数据已更新”。  
   后置条件：管理员实时查看系统核心数据  
   异常情况：  
   - 数据查询失败：卡片显示“--”代替具体数值，并提示“数据加载失败，请刷新重试”；  
   - 热门图书数据为空：显示“暂无热门图书数据”。  


3. **用例名称：快捷功能入口跳转**  
   用例编号：UC-3.7.3  
   参与者：主参与者：管理员  
   触发条件：管理员点击“添加新图书”“查看待发货订单”等快捷按钮  
   前置条件：管理员已登录首页  
   主要流程：  
   1. 管理员点击“添加新图书”按钮：系统跳转至图书编辑页（`/toUpdateBookPage`）；  
   2. 管理员点击“查看待发货订单”按钮：系统跳转至订单管理页并默认筛选“未发货”状态（`/getOrders?status=未发货`）；  
   3. 管理员点击“热门图书详情”按钮：跳转至图书管理页并筛选对应图书（`/getPageBooks?keyword=xxx`）；  
   4. 管理员点击顶部导航的“图书管理”“订单管理”：跳转至对应页面并高亮当前页链接。  
   后置条件：管理员成功跳转至目标功能页  
   异常情况：  
   - 目标页面不存在：显示“页面不存在”错误页；  
   - 跳转参数错误（如图书ID无效）：跳转至目标页首页并提示“参数错误”。  


4. **用例名称：防频繁操作限制**  
   用例编号：UC-3.7.4  
   参与者：主参与者：管理员  
   触发条件：管理员短时间内频繁刷新页面或提交操作  
   前置条件：管理员已登录首页  
   主要流程：  
   1. 系统记录5分钟内的页面刷新及按钮点击次数；  
   2. 当操作次数超过10次/分钟时：临时禁止操作30秒并提示“操作过于频繁，请30秒后再试”；  
   3. 限制时间内再次操作：延长限制时间至1分钟；  
   4. 限制时间结束后，恢复正常访问权限并重置计数。  
   后置条件：有效防止恶意刷新或重复提交行为  
   异常情况：  
   - 操作次数统计异常（如缓存失效）：默认关闭限制，仅在日志中记录警告。  


5. **用例名称：登录信息展示与安全提示**  
   用例编号：UC-3.7.5  
   参与者：主参与者：管理员  
   触发条件：管理员成功登录首页  
   前置条件：管理员登录状态有效  
   主要流程：  
   1. 页面顶部显示管理员用户名及最近登录时间（如“欢迎 admin，上次登录时间：2024-06-11 16:20:10”）；  
   2. 若最近登录IP与当前IP不一致：提示“检测到异地登录，请注意账号安全”；  
   3. 会话剩余有效期小于5分钟时：弹窗提示“您的登录即将过期，是否延长会话？”，点击“是”则延长有效期30分钟。  
   后置条件：管理员获取登录相关信息及安全提示  
   异常情况：  
   - 最近登录记录查询失败：隐藏最近登录时间，仅显示欢迎信息。  


## 3.8 登录注册页模块需求说明
### 3.8.1 登录注册页页面数据项
| 数据项名称         | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|--------------------|----------|----------|---------------------------------|------------------------------------------|
| 用户名             | STRING   | 是       | "user123"                       | 用户登录/注册的账号，唯一标识，长度6-20位，支持字母、数字、下划线 |
| 密码               | STRING   | 是       | "pwd@123456"                    | 用户密码（存储时经MD5加密），长度8-20位，需包含字母、数字及特殊字符 |
| 确认密码           | STRING   | 是（注册）| "pwd@123456"                    | 注册时需与密码一致，用于校验输入准确性   |
| 电子邮箱           | STRING   | 是（注册）| "user@example.com"              | 用户注册邮箱，用于身份验证或找回密码，需符合邮箱格式 |
| 验证码             | STRING   | 是       | "8A3F"                          | 图形验证码，区分大小写，有效时长5分钟     |
| 记住登录状态       | BOOLEAN  | 否       | true                           | 登录时勾选，Cookie有效期设为7天，未勾选则为2小时 |
| 登录失败次数       | INT      | 是       | 3                               | 记录连续登录失败次数，超过5次则锁定账号1小时 |
| 用户名验证结果     | STRING   | 是（注册）| "用户名可用"                    | 实时验证用户名是否已存在，可选值：“用户名可用”“用户名已存在”“用户名格式错误” |
| 注册IP地址         | STRING   | 是       | "192.168.1.1"                   | 记录注册时的IP，用于限制批量注册         |
| 协议同意状态       | BOOLEAN  | 是（注册）| true                           | 注册时需勾选“同意用户协议”，否则无法提交 |

### 3.8.2 登录注册页功能用例分析

1. **用例名称：用户登录**  
   用例编号：UC-3.8.1  
   参与者：主参与者：用户  
   触发条件：用户输入用户名、密码、验证码并点击“登录”按钮  
   前置条件：用户已进入登录页  
   主要流程：  
   1. 前端验证：  
      - 检查用户名/密码/验证码是否为空，为空则提示“请完善登录信息”；  
      - 验证验证码是否正确，错误则提示“验证码错误”并刷新验证码；  
   2. 提交表单至`/login`接口，后端验证用户名、密码及账号状态；  
   3. 验证通过：  
      - 普通用户：创建Session，若勾选“记住登录状态”则设置长效Cookie，跳转至商城首页（`/main`），显示“登录成功，欢迎回来”；  
      - 管理员：创建Session，跳转至管理员首页，显示“管理员登录成功”；  
   4. 验证失败：  
      - 用户名或密码错误：页面显示“用户名或密码不正确”，登录失败次数+1，保留用户名输入；  
      - 账号被锁定：提示“账号已被锁定，请1小时后再试”。  
   后置条件：用户成功登录或获取明确的失败原因  
   异常情况：  
   - 数据库连接失败：提示“登录异常，请稍后重试”；  
   - Session创建失败：登录成功后跳转至首页但未保持登录状态，提示“登录状态异常”。  


2. **用例名称：用户注册**  
   用例编号：UC-3.8.2  
   参与者：主参与者：新用户  
   触发条件：用户填写注册信息并点击“注册”按钮  
   前置条件：用户已进入注册页  
   主要流程：  
   1. 前端实时验证：  
      - 用户名：输入时检测格式及唯一性，不符合则实时提示（如“用户名长度需6-20位”）；  
      - 密码：检测格式，不符合则提示（如“密码需包含字母、数字和特殊字符”）；  
      - 确认密码：与密码不一致时提示“两次输入的密码不一致”；  
      - 邮箱：检测格式，不符合则提示“请输入有效的邮箱地址”；  
   2. 用户勾选“同意用户协议”并点击“注册”，前端再次校验所有字段；  
   3. 提交表单至`/regist`接口，后端执行：  
      - 再次验证用户名唯一性（防并发注册）；  
      - 对密码进行MD5加密后存储；  
      - 记录注册IP及时间；  
   4. 注册成功：跳转至登录页，提示“注册成功，请登录”；  
   5. 注册失败：根据错误类型提示（如“邮箱已被注册”“IP今日注册次数超限”）。  
   后置条件：新用户成功注册或获取明确的失败原因  
   异常情况：  
   - 注册过程中网络中断：页面保留已填信息，提示“网络异常，请重试”；  
   - 邮箱格式正确但无法接收邮件（非必填流程）：不影响注册，仅提示“验证邮件发送失败，可正常登录”。  


3. **用例名称：验证码生成与验证**  
   用例编号：UC-3.8.3  
   参与者：主参与者：用户  
   触发条件：用户加载登录/注册页或点击“刷新验证码”  
   前置条件：页面已加载完成  
   主要流程：  
   1. 页面加载时，系统调用`/getCaptcha`接口生成随机验证码（4位字母数字组合）；  
   2. 接口返回验证码图片（含干扰线、噪点）及对应的唯一标识（用于后端校验）；  
   3. 用户点击“刷新验证码”：重新调用接口生成新验证码；  
   4. 用户提交登录/注册表单时，前端将用户输入的验证码与标识一同提交；  
   5. 后端根据标识查询存储的验证码，验证一致性。  
   后置条件：用户获取有效验证码并完成验证  
   异常情况：  
   - 验证码生成失败：显示默认图片并提示“验证码加载失败”；  
   - 验证码过期（超过5分钟）：提示“验证码已过期，请刷新”。  


4. **用例名称：密码强度检测**  
   用例编号：UC-3.8.4  
   参与者：主参与者：注册用户  
   触发条件：用户在注册页输入密码  
   前置条件：用户进入注册流程  
   主要流程：  
   1. 用户输入密码时，前端实时检测密码复杂度：  
      - 弱：仅包含字母或数字（如“123456”“abcdef”），显示红色进度条及“密码强度：弱”；  
      - 中：包含字母和数字（如“abc123”），显示黄色进度条及“密码强度：中”；  
      - 强：包含字母、数字和特殊字符（如“abc@123”），显示绿色进度条及“密码强度：强”；  
   2. 若密码强度为“弱”：提示“建议使用更强的密码（包含字母、数字和特殊字符）”；  
   3. 仅当密码强度为“中”或“强”时，允许提交注册表单。  
   后置条件：用户明确密码强度并输入符合要求的密码  
   异常情况：  
   - 检测逻辑异常：默认允许提交，但后端再次校验，不符合则返回“密码强度不足”。  


## 3.9 结账页模块需求说明
### 3.9.1 结账页页面数据项
| 数据项名称         | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|--------------------|----------|----------|---------------------------------|------------------------------------------|
| 购物车ID           | STRING   | 是       | "cart_123456"                   | 用户购物车唯一标识，用于关联购物项       |
| 购物项列表         | 数组     | 是       | [{"bookId":101,"title":"三体",...},...] | 待结算的图书信息，含图书ID、名称、封面、单价、数量、小计金额 |
| 商品总数量         | INT      | 是       | 3                               | 所有购物项的数量总和                     |
| 商品总金额         | FLOAT    | 是       | 256.50                          | 所有购物项的金额总和，保留两位小数       |
| 收货地址列表       | 数组     | 是       | [{"addrId":5,"name":"张三",...},...] | 用户保存的收货地址，含地址ID、收件人、电话、详细地址、是否默认 |
| 选中的地址ID       | INT      | 是       | 5                               | 用户当前选中的收货地址ID，用于生成订单   |
| 支付方式列表       | 数组     | 是       | ["微信支付","支付宝","银行卡"]  | 支持的支付方式选项                       |
| 选中的支付方式     | STRING   | 是       | "微信支付"                      | 用户选择的支付方式                       |
| 订单备注           | STRING   | 否       | "请在工作日送货"                | 用户填写的订单附加说明，长度不超过200字  |
| 优惠券列表         | 数组     | 否       | [{"couponId":3,"discount":10,...},...] | 用户可用的优惠券，含券ID、折扣金额、使用门槛 |
| 实付金额           | FLOAT    | 是       | 246.50                          | 总金额减去优惠券折扣后的金额，保留两位小数 |
| 用户ID             | INT      | 是       | 789                             | 当前登录用户的唯一标识，用于关联订单     |

### 3.9.2 结账页功能用例分析

1. **用例名称：购物车数据加载与展示**  
   用例编号：UC-3.9.1  
   参与者：主参与者：已登录用户  
   触发条件：用户点击购物车中的“去结账”按钮  
   前置条件：用户购物车中存在商品且已登录  
   主要流程：  
   1. 系统调用`/getCartInfo`接口获取用户购物车中的所有商品；  
   2. 页面渲染购物项列表，展示每本图书的封面、名称、单价、数量及小计金额；  
   3. 自动计算并显示商品总数量和总金额；  
   4. 若购物项中存在库存不足的商品（如当前库存 < 购物车数量）：  
      - 高亮显示该商品并提示“库存不足，当前可购XX本”；  
      - 提供“调整数量”按钮允许修改，或“移除”按钮删除该商品。  
   后置条件：用户清晰查看待结算的购物车数据  
   异常情况：  
   - 购物车数据查询失败：提示“购物车数据加载失败，请返回重试”；  
   - 购物车为空：自动跳转回购物车页面并提示“购物车为空，无法结账”。  


2. **用例名称：收货地址管理**  
   用例编号：UC-3.9.2  
   参与者：主参与者：已登录用户  
   触发条件：用户在结账页选择或添加收货地址  
   前置条件：用户已进入结账页  
   主要流程：  
   1. 系统调用`/getUserAddresses`接口获取用户保存的所有收货地址；  
   2. 页面展示地址列表，默认选中用户的默认地址（若存在）；  
   3. 用户点击其他地址：更新选中状态，后续订单将使用该地址；  
   4. 用户点击“添加新地址”：  
      - 弹出地址表单（含收件人、电话、省市区、详细地址字段）；  
      - 提交后调用`/addAddress`接口保存，成功后刷新地址列表并选中新地址。  
   后置条件：用户成功选择或添加收货地址  
   异常情况：  
   - 地址查询失败：提示“地址加载失败”，但允许继续添加新地址；  
   - 新增地址格式错误（如电话位数不对）：提示“请输入有效的联系方式”。  


3. **用例名称：支付方式选择**  
   用例编号：UC-3.9.3  
   参与者：主参与者：已登录用户  
   触发条件：用户在结账页选择支付方式  
   前置条件：用户已加载结账页且购物车数据有效  
   主要流程：  
   1. 页面展示支持的支付方式列表（如微信支付、支付宝）；  
   2. 用户点击某支付方式：选中状态切换，记录用户选择；  
   3. 若选择“银行卡支付”：额外显示银行卡号输入框（带格式校验）；  
   4. 提交订单时，将选中的支付方式传入订单数据。  
   后置条件：用户成功选择支付方式  
   异常情况：  
   - 支付方式列表加载失败：默认选中“微信支付”并提示“支付方式加载异常，默认使用微信支付”。  


4. **用例名称：订单提交与生成**  
   用例编号：UC-3.9.4  
   参与者：主参与者：已登录用户  
   触发条件：用户点击“提交订单”按钮  
   前置条件：用户已完成地址选择、支付方式选择，购物车数据有效  
   主要流程：  
   1. 前端校验：  
      - 检查是否选中收货地址，未选中则提示“请选择收货地址”；  
      - 检查是否选择支付方式，未选择则提示“请选择支付方式”；  
   2. 调用`/checkout`接口提交订单数据（含购物车ID、地址ID、支付方式、备注等）；  
   3. 后端执行：  
      - 再次校验库存（防并发超卖）；  
      - 生成唯一订单号，创建订单记录；  
      - 扣减对应图书库存，清空购物车或移除已结算商品；  
   4. 提交成功：跳转至支付页，携带订单号及实付金额；  
   5. 提交失败：根据错误提示（如“部分商品已售罄”），允许用户调整后重新提交。  
   后置条件：订单成功生成或获取明确的失败原因  
   异常情况：  
   - 提交过程中网络中断：提示“提交失败，请检查网络”，允许重试（需防重复下单）；  
   - 库存校验失败：返回“商品《XXX》库存不足”，并刷新购物车数据。  


5. **用例名称：优惠券使用**  
   用例编号：UC-3.9.5  
   参与者：主参与者：已登录用户  
   触发条件：用户在结账页选择优惠券  
   前置条件：用户有可用优惠券且总金额满足使用门槛  
   主要流程：  
   1. 系统调用`/getUserCoupons`接口获取用户可用优惠券；  
   2. 页面展示优惠券列表，标注每张券的折扣金额及使用门槛（如“满100减10”）；  
   3. 用户选择某优惠券：  
      - 若满足使用门槛（总金额 ≥ 门槛）：实付金额 = 总金额 - 折扣金额，页面实时更新；  
      - 若不满足：提示“订单金额未达到使用门槛”，无法选中；  
   4. 用户取消选择：实付金额恢复为总金额。  
   后置条件：用户成功使用或取消优惠券  
   异常情况：  
   - 优惠券列表加载失败：提示“优惠券加载失败，可正常提交订单”，不影响结账流程。
