# 软件需求分析

## 首部

### 项目信息

- **项目名称**: Go语言书城项目

- **项目标识**: GOBOOKSTORE-2025-001

- **版本**: V1.0

### 状态与版本信息

- **文件状态**: 草稿

- **文件标识**: SC-GOBOOKSTORE-V1.0-ProgramAnlayz

- **当前版本**: V1.0

- **作者**:
  
  - **姓名**: 陈泓瑞
  
  - **学号**: 2022011153
  
  - **姓名**: 何祎凡
  
  - **学号**: 2022011145
  
  - **姓名**: 王炳祺
  
  - **学号**: 2022011146
  
  - **姓名**: 傅宇驰
  
  - **学号**: 2022011127
  
  - **团队**:404回收站
 
   ## 3 服务端模块需求说明
  ### 3.1 首页

#### 3.1.1 首页页面数据项
| 数据项名称       | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|------------------|----------|----------|---------------------------------|------------------------------------------|
| 图书 ID          | INT      | 是       | 1001                            | 图书唯一标识，用于关联图书详情、购物车操作等 |
| 图书封面         | STRING   | 是       | "/static/img/three_kingdoms.jpg" | 图书封面图片路径，展示图书外观           |
| 图书名称         | STRING   | 是       | "三国演义"                      | 图书标题，用于用户识别图书               |
| 图书作者         | STRING   | 是       | "罗贯中"                        | 图书作者信息                             |
| 图书价格         | FLOAT    | 是       | 88.88                           | 图书售价，保留两位小数                   |
| 图书销量         | INT      | 是       | 100                             | 图书累计销售数量，用于展示热门程度       |
| 图书库存         | INT      | 是       | 50                              | 图书当前库存数量，库存为 0 时显示 “补货中” |
| 价格筛选下限     | FLOAT    | 否       | 50                              | 用户输入的价格筛选最小值，为空时不限制下限 |
| 价格筛选上限     | FLOAT    | 否       | 100                             | 用户输入的价格筛选最大值，为空时不限制上限 |
| 当前页码         | INT      | 是       | 2                              | 分页导航中的当前页码，默认从 1 开始       |
| 总页数           | INT      | 是       | 5                              | 符合条件的图书总页数，由总记录数和每页显示条数计算得出 |
| 总记录数         | INT      | 是       | 20                             | 符合条件的图书总数量                     |
| 登录状态         | BOOLEAN  | 是       | true                           | 标识用户是否登录（true 为已登录，false 为未登录），控制 “加入购物车” 按钮状态 |


#### 3.1.2 首页功能用例分析

1. **用例名称：图书列表展示与分页**  
   用例编号：UC-1.1  
   参与者：主参与者：用户、管理员  
   触发条件：用户访问首页或切换分页页码  
   前置条件：系统已加载图书数据  
   主要流程：  
   1. 系统接收用户请求（默认首页或指定页码）；  
   2. 系统调用`GetPageBooks`或`GetPageBooksByPrice`接口查询对应页码的图书数据；  
   3. 系统计算总页数、总记录数并返回分页信息；  
   4. 页面渲染图书列表（包含封面、名称、作者等信息）及分页导航；  
   5. 分页导航显示 “首页、上一页、下一页、末页” 及页码输入框。  
   后置条件：用户成功查看对应页码的图书列表  
   异常情况：  
   - 数据库查询失败：页面显示 “暂无图书数据” 提示；  
   - 用户输入无效页码（如负数或超过总页数）：系统自动跳转至首页。  


2. **用例名称：价格范围筛选图书**  
   用例编号：UC-1.2  
   参与者：主参与者：用户  
   触发条件：用户输入价格区间并提交筛选  
   前置条件：用户已进入首页  
   主要流程：  
   1. 用户在价格筛选表单中输入下限和 / 或上限价格；  
   2. 点击 “筛选” 按钮提交请求；  
   3. 系统调用`GetPageBooksByPrice`接口查询符合价格条件的图书；  
   4. 页面重新渲染符合条件的图书列表及分页信息。  
   后置条件：用户成功查看符合价格条件的图书  
   异常情况：  
   - 输入价格格式错误（如非数字）：系统提示 “请输入有效的价格”；  
   - 无符合条件的图书：页面显示 “未找到符合条件的图书”。  


3. **用例名称：添加图书到购物车**  
   用例编号：UC-1.3  
   参与者：主参与者：已登录用户；次要参与者：未登录用户  
   触发条件：用户点击图书的 “加入购物车” 按钮  
   前置条件：图书库存 > 0  
   主要流程：  
   1. 系统检测用户登录状态（通过`IsLogin`接口验证）；  
   2. 若已登录：  
      - 调用`AddBook2Cart`接口将图书添加到用户购物车（已存在则更新数量，不存在则创建购物项）；  
      - 页面显示 “添加成功” 提示；  
   3. 若未登录：  
      - 页面显示 “请先登录” 提示。  
   后置条件：已登录用户的购物车中成功添加对应图书  
   异常情况：  
   - 图书库存不足：按钮置灰并提示 “库存不足”；  
   - 购物车添加失败（如数据库错误）：页面显示 “添加失败，请重试”。  


4. **用例名称：库存状态展示**  
   用例编号：UC-1.4  
   参与者：主参与者：用户  
   触发条件：图书列表加载完成  
   前置条件：系统已获取图书库存数据  
   主要流程：  
   1. 系统遍历图书列表，检查每本图书的库存数量；  
   2. 若库存 > 0：显示 “加入购物车” 按钮（可点击）；  
   3. 若库存 = 0：显示 “补货中” 提示（按钮隐藏或置灰）。  
   后置条件：用户清晰识别图书库存状态  
   异常情况：  
   - 库存数据查询异常：默认显示 “库存未知” 提示。

### 3.2图书管理页

#### 3.2.1页面数据项
| 数据项名称   | 数据类型   | 是否必填 | 示例值                          | 说明                                                                 |
|--------------|------------|----------|---------------------------------|----------------------------------------------------------------------|
| 图书ID       | INT        | 是       | 1001                            | 图书唯一标识，用于编辑、删除操作的参数传递                         |
| 图书名称     | STRING     | 是       | "三国演义"                      | 图书标题，展示在列表中                                               |
| 图书作者     | STRING     | 是       | "罗贯中"                        | 图书作者信息                                                         |
| 图书价格     | FLOAT      | 是       | 88.88                           | 图书售价，保留两位小数                                               |
| 图书销量     | INT        | 是       | 100                             | 图书累计销售数量                                                     |
| 图书库存     | INT        | 是       | 50                              | 图书当前库存数量                                                     |
| 当前页码     | INT        | 是       | 2                              | 分页导航中的当前页码，默认从1开始                                   |
| 总页数       | INT        | 是       | 5                              | 符合条件的图书总页数，由总记录数和每页显示条数计算得出               |
| 总记录数     | INT        | 是       | 20                             | 符合条件的图书总数量                                                 |

### 3.2.2图书管理页功能点用例分析

1. #### 用例名称：图书列表分页展示
- **用例编号**：UC-2.1  
- **参与者**：管理员  
- **触发条件**：管理员访问图书管理页，或通过分页控件切换页码（如点击“上一页”“下一页”、输入页码并确认）  
- **前置条件**：系统已连接数据库且存在图书数据  
- **主要流程**：  
  1. 系统接收页面请求（默认加载第1页，或携带指定页码参数）；  
  2. 调用`GetPageBooks`接口，根据页码计算分页偏移量（每页默认显示4条记录）；  
  3. 从数据库查询对应页的图书数据（包含ID、名称、价格、作者、销量、库存等信息）；  
  4. 计算总记录数和总页数，生成分页信息（当前页、总页数、是否有上一页/下一页等）；  
  5. 页面渲染图书列表表格及分页控件（首页、上一页、下一页、末页按钮和页码输入框）。  
- **后置条件**：管理员成功查看对应页码的图书列表  
- **异常情况**：  
  1. 数据库查询失败：页面显示空列表，无图书数据；  
  2. 输入无效页码（如负数或大于总页数）：系统自动跳转至第1页。  


2. #### 用例名称：图书删除操作
- **用例编号**：UC-2.2  
- **参与者**：管理员  
- **触发条件**：管理员点击某本图书后的“删除”按钮  
- **前置条件**：待删除图书存在于数据库中  
- **主要流程**：  
  1. 点击“删除”按钮时，系统弹出确认弹窗（显示图书名称，提示“确定要删除【xxx】这本图书吗？”）；  
  2. 管理员确认删除后，系统获取该图书的ID并调用`DeleteBook`接口；  
  3. 接口执行数据库删除操作，移除该图书记录；  
  4. 页面重新加载当前页的图书列表（若删除后当前页无数据，自动跳转至上一页）。  
- **后置条件**：图书从数据库中移除，列表中不再显示该图书  
- **异常情况**：  
  1. 数据库删除失败：页面不刷新，图书仍显示在列表中；  
  2. 管理员取消确认：删除操作终止，列表无变化。  


3. #### 用例名称：图书编辑操作
- **用例编号**：UC-2.3  
- **参与者**：管理员  
- **触发条件**：管理员点击某本图书后的“修改”按钮  
- **前置条件**：待编辑图书存在于数据库中  
- **主要流程**：  
  1. 点击“修改”按钮后，系统携带图书ID跳转至`toUpdateBookPage`接口；  
  2. 接口查询该图书的详细信息（名称、价格、作者、销量、库存等）；  
  3. 页面跳转至`book_edit.html`，表单预填充图书当前信息；  
  4. 管理员修改表单数据后点击“提交”，系统调用`updateOraddBook`接口；  
  5. 接口执行数据库更新操作，保存修改后的图书信息；  
  6. 操作完成后跳转回图书管理页，列表显示更新后的图书数据。  
- **后置条件**：图书信息更新至数据库，列表同步刷新  
- **异常情况**：  
  1. 输入数据格式错误（如价格为非数字）：接口未执行更新，页面无提示（需补充前端校验）；  
  2. 数据库更新失败：图书信息未变更，页面仍显示旧数据。  


4. #### 用例名称：图书添加操作
- **用例编号**：UC-2.4  
- **参与者**：管理员  
- **触发条件**：管理员点击图书列表底部的“添加图书”链接  
- **前置条件**：管理员已进入图书管理页  
- **主要流程**：  
  1. 点击“添加图书”后，系统跳转至`toUpdateBookPage`接口（无图书ID参数）；  
  2. 页面加载`book_edit.html`，显示空表单（包含名称、价格、作者、销量、库存输入框）；  
  3. 管理员填写表单信息后点击“提交”，系统调用`updateOraddBook`接口；  
  4. 接口执行数据库插入操作，创建新图书记录（默认封面图路径为`/static/img/default.jpg`）；  
  5. 操作完成后跳转回图书管理页，列表显示新添加的图书。  
- **后置条件**：新图书被添加至数据库，列表中新增该图书记录  
- **异常情况**：  
  1. 输入数据不完整（如未填写书名）：接口未执行插入，页面无提示（需补充前端校验）；  
  2. 数据库插入失败：无新图书记录生成，列表无变化。  


5. #### 用例名称：管理员权限控制
- **用例编号**：UC-2.5  
- **参与者**：系统、管理员、普通用户  
- **触发条件**：用户访问图书管理页（通过`/getPageBooks`路由）  
- **前置条件**：系统已实现用户身份验证逻辑  
- **主要流程**：  
  1. 系统通过会话（Session）判断访问者身份；  
  2. 若为管理员：允许访问`getPageBooks`接口，返回图书列表及管理功能页面；  
  3. 若为普通用户或未登录用户：系统拦截请求，可能跳转至登录页或拒绝访问（当前代码未明确实现，需结合权限逻辑补充）。  
- **后置条件**：管理员正常使用图书管理功能，非管理员被限制访问  
- **异常情况**：  
  1. 权限判断逻辑异常：非管理员可能绕过验证访问管理页；  
  2. 会话失效：管理员需重新登录后才能访问。

### 3.5.1个人订单页

#### 3.5.1 个人订单页数据项
| 数据项名称       | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|------------------|----------|----------|---------------------------------|------------------------------------------|
| 订单 ID          | STRING   | 是       | "uuid-20240612-12345"           | 订单唯一标识，由系统生成，用于关联订单详情、状态更新等操作 |
| 订单创建时间     | STRING   | 是       | "2024-06-12 15:30:22"          | 订单生成的精确时间，格式为“年-月-日 时:分:秒”，支持按时间排序 |
| 订单总数量       | INT      | 是       | 3                              | 订单中所有商品的数量总和，用于快速展示订单规模 |
| 订单总金额       | FLOAT    | 是       | 256.50                         | 订单最终支付金额（含商品费用，不含运费时与商品总金额一致），保留两位小数 |
| 订单状态         | INT      | 是       | 1                              | 状态枚举：0-未支付，1-已支付待发货，2-已发货，3-已完成，4-已取消，5-退款中，6-已退款 |
| 订单状态文本     | STRING   | 是       | "已发货"                        | 订单状态的文字描述，与“订单状态”字段一一对应，提升用户可读性 |
| 收货地址         | STRING   | 是       | "北京市朝阳区XX街道XX小区3号楼1单元501" | 订单对应的收货地址，包含省、市、区、详细地址，支持用户快速核对 |
| 收货人姓名       | STRING   | 是       | "张三"                          | 订单收货人姓名，用于物流配送核对 |
| 联系电话         | STRING   | 是       | "13800138000"                  | 收货人联系电话，支持隐藏中间4位（如“138****8000”）保护隐私 |
| 支付方式         | STRING   | 是       | "微信支付"                      | 订单支付渠道，如“微信支付”“支付宝”“银行卡支付” |
| 支付时间         | STRING   | 否       | "2024-06-12 15:35:10"          | 订单支付完成时间，未支付订单该字段为空 |
| 订单状态筛选     | INT      | 否       | 2                              | 用于筛选特定状态订单，取值与“订单状态”一致，为空时默认显示所有状态订单 |
| 当前页码         | INT      | 是       | 1                              | 分页导航的当前页码，默认从1开始，支持用户手动输入跳转 |
| 总页数           | INT      | 是       | 5                              | 符合当前筛选条件的订单总页数，由“总记录数/每页显示条数”向上取整计算 |
| 总记录数         | INT      | 是       | 48                             | 符合当前筛选条件的订单总数量，用于分页逻辑计算和页面提示 |
| 每页显示条数     | INT      | 是       | 10                             | 每页展示的订单数量，支持系统配置（如5/10/20条），默认10条 |
| 用户 ID          | STRING   | 是       | "user-789"                     | 当前登录用户的唯一标识，用于接口查询用户专属订单数据 |
| 物流单号         | STRING   | 否       | "SF1234567890123"              | 订单对应的物流单号，仅“已发货”状态订单有值，支持点击复制 |
| 物流公司         | STRING   | 否       | "顺丰速运"                      | 订单配送的物流公司名称，与“物流单号”配套展示 |


#### 3.5.2 个人订单页功能用例分析

1. **用例名称：加载个人订单列表**  
   用例编号：UC-5.1  
   参与者：主参与者：已登录用户  
   触发条件：用户点击导航栏“我的订单”按钮、刷新页面、登录后自动跳转至该页面  
   前置条件：1. 用户已完成登录验证；2. 系统已获取用户ID  
   主要流程：  
   1. 系统通过`CheckUserLogin`接口验证用户登录状态，确认用户token有效；  
   2. 若未登录：自动跳转至登录页，URL携带回调参数（如`/login?redirect=/my-orders`），登录成功后返回个人订单页；  
   3. 若已登录：系统携带“用户ID”“当前页码”“每页显示条数”“订单状态筛选（默认空）”参数，调用`QueryUserOrdersList`接口；  
   4. 接口返回订单列表数据（含订单ID、创建时间等核心字段）、总页数、总记录数；  
   5. 页面按“创建时间倒序”渲染订单列表，每笔订单展示“订单状态标签”“创建时间”“收货信息摘要”“总金额”“操作按钮组”；  
   6. 页面底部渲染分页控件，显示当前页码、总页数及“首页/上一页/下一页/末页”按钮。  
   后置条件：用户成功查看符合当前筛选条件的订单列表（或无订单提示）  
   异常情况：  
   - 接口调用失败（如网络异常、数据库错误）：页面显示“获取订单失败，请点击重试”，提供“重试”按钮；  
   - 无符合条件的订单：页面显示“暂无相关订单”图标+文字，提供“去首页购物”按钮，跳转至商品首页；  
   - 用户token过期：弹出“登录已过期，请重新登录”提示，点击后跳转至登录页。  


2. **用例名称：订单状态筛选**  
   用例编号：UC-5.2
   参与者：主参与者：已登录用户  
   触发条件：用户点击页面顶部状态筛选栏（如“全部”“待发货”“已发货”“已完成”“已取消”）  
   前置条件：1. 个人订单列表已加载完成；2. 筛选栏状态选项正常显示  
   主要流程：  
   1. 用户点击目标状态选项（如“已发货”），系统记录当前筛选状态值（如2）；  
   2. 系统自动将“当前页码”重置为1，携带“用户ID”“筛选状态”“页码=1”“每页显示条数”参数，调用`QueryUserOrdersList`接口；  
   3. 接口返回符合筛选条件的订单数据、总页数、总记录数；  
   4. 页面更新订单列表内容，同步更新分页控件的“总页数”“总记录数”，高亮当前选中的筛选状态选项；  
   5. 若筛选后无数据：页面显示“暂无该状态订单”提示，筛选状态选项保持选中。  
   后置条件：用户成功查看指定状态的订单列表  
   异常情况：  
   - 筛选状态参数传递错误（如非法值）：接口默认按“全部”状态查询，页面不提示，仅展示全部订单；  
   - 接口返回筛选数据为空：页面显示“暂无该状态订单”，提供“查看全部订单”按钮，点击后重置筛选状态为“全部”。  


3. **用例名称：取消订单**  
   用例编号：UC-5.3  
   参与者：主参与者：已登录用户  
   触发条件：用户点击订单操作栏“取消订单”按钮（仅“未支付”“已支付待发货”状态订单显示该按钮）  
   前置条件：1. 订单状态为0（未支付）或1（已支付待发货）；2. 用户已确认取消操作  
   主要流程：  
   1. 用户点击“取消订单”按钮，系统弹出确认弹窗，提示“取消订单后将无法恢复，是否确认？”，提供“确认取消”“取消”按钮；  
   2. 若用户点击“取消”：关闭弹窗，返回订单列表页面，无其他操作；  
   3. 若用户点击“确认取消”：系统携带“用户ID”“订单ID”参数，调用`UpdateOrderStatus`接口，请求将订单状态更新为4（已取消）；  
   4. 接口返回更新结果：  
      - 成功：弹窗显示“订单取消成功”，2秒后自动关闭，页面重新调用`QueryUserOrdersList`接口刷新订单列表，该订单状态更新为“已取消”，操作按钮组隐藏；  
      - 失败：弹窗显示具体错误信息（如“当前订单已发货，无法取消”“系统繁忙，请稍后重试”）。  
   后置条件：符合条件的订单状态更新为“已取消”，订单列表同步刷新  
   异常情况：  
   - 订单状态已变更（如用户点击时订单已被商家发货）：接口返回“订单状态已更新，无法取消”，弹窗提示用户；  
   - 未支付订单取消：系统自动清空该订单关联的购物车锁定库存（若有）；  
   - 已支付订单取消：系统触发退款流程，弹窗额外提示“退款将在1-3个工作日原路返回，请注意查收”。  


4. **用例名称：订单列表分页操作**  
   用例编号：UC-5.4  
   参与者：主参与者：已登录用户  
   触发条件：用户点击分页控件“首页/上一页/下一页/末页”按钮，或在页码输入框输入页码后按回车  
   前置条件：1. 总页数>1（分页控件正常启用）；2. 当前筛选状态已确定  
   主要流程：  
   1. **点击“首页”**：系统将“当前页码”设为1，调用`QueryUserOrdersList`接口，加载第1页订单数据，分页控件高亮“1”页码；  
   2. **点击“上一页”**：系统判断当前页码>1，将页码减1，调用接口加载对应页数据；若当前页码=1，按钮置灰不可点击，无操作；  
   3. **点击“下一页”**：系统判断当前页码<总页数，将页码加1，调用接口加载对应页数据；若当前页码=总页数，按钮置灰不可点击，无操作；  
   4. **点击“末页”**：系统将“当前页码”设为总页数，调用接口加载最后一页数据，分页控件高亮总页数页码；  
   5. **手动输入页码**：用户在页码输入框输入数字（如3），按回车后：  
      - 若输入为有效数字（1≤页码≤总页数）：系统加载对应页数据，输入框显示当前页码；  
      - 若输入无效（如0、负数、超过总页数、非数字）：输入框提示“请输入1-XX之间的数字”（XX为总页数），不调用接口。  
   后置条件：用户成功查看指定页码的订单列表，分页控件状态与当前页码匹配  
   异常情况：  
   - 切换页码时接口调用失败：页面保留当前页数据，显示“页面加载失败，请重试”提示，提供“重试”按钮，点击后重新加载目标页码；  
   - 手动输入非数字：输入框实时校验，失去焦点时提示“请输入有效数字”。  


5. **用例名称：查看订单详情**  
   用例编号：UC-5.5  
   参与者：主参与者：已登录用户  
   触发条件：用户点击订单卡片“查看详情”按钮（所有状态订单均显示该按钮）  
   前置条件：1. 订单列表已加载；2. 点击的订单ID有效且归属当前用户  
   主要流程：  
   1. 用户点击“查看详情”按钮，系统获取该订单的“订单ID”；  
   2. 系统通过URL参数跳转至订单详情页（如`/order-detail?orderId=uuid-20240612-12345`）；  
   3. 跳转后，订单详情页自动携带“用户ID”“订单ID”调用`QueryOrderDetail`接口，查询订单完整信息（含订单项、物流、支付明细等）；  
   4. 若接口返回“订单不存在”或“订单不属于当前用户”：详情页显示“无效的订单信息”，提供“返回我的订单”按钮；  
   5. 若接口返回正常：详情页按“订单基本信息-订单项列表-支付信息-物流信息”结构渲染内容。  
   后置条件：用户成功跳转至订单详情页，可查看订单完整信息  
   异常情况：  
   - 跳转时订单ID丢失（如URL参数被篡改）：详情页显示“订单ID缺失，请返回重新选择”；  
   - 接口调用超时：详情页显示“获取订单详情超时，请点击重试”，提供“重试”按钮。  


6. **用例名称：查看物流信息**  
   用例编号：UC-5.6  
   参与者：主参与者：已登录用户  
   触发条件：用户点击订单操作栏“查看物流”按钮（仅“已发货”“已完成”状态订单显示该按钮）  
   前置条件：1. 订单状态为2（已发货）或3（已完成）；2. 订单已关联物流单号和物流公司  
   主要流程：  
   1. 用户点击“查看物流”按钮，系统获取该订单的“订单ID”“物流单号”“物流公司”；  
   2. 系统弹出物流信息弹窗，弹窗标题显示“物流详情（物流公司：XX）”，顶部展示“物流单号”及“复制”按钮；  
   3. 系统携带“物流单号”“物流公司”调用`QueryLogisticsTrack`接口，获取物流轨迹数据；  
   4. 接口返回物流轨迹列表（按时间倒序，含“时间”“地点”“描述”字段）：  
      - 若轨迹数据正常：弹窗按“最新轨迹置顶”渲染，每条轨迹显示时间、地点和操作描述（如“【北京市】快递已发出”）；  
      - 若轨迹数据为空/未更新：弹窗显示“物流信息暂未更新，请稍后查询”；  
   5. 用户点击“复制”按钮：系统复制物流单号到剪贴板，弹窗提示“物流单号已复制”；  
   6. 用户点击弹窗“关闭”按钮或外部空白区域：弹窗关闭，返回订单列表页。  
   后置条件：用户成功查看订单物流轨迹（或获取物流未更新提示）  
   异常情况：  
   - 物流接口调用失败：弹窗显示“获取物流信息失败，请重试”，提供“重试”按钮；  
   - 物流单号无效（如商家填写错误）：接口返回“无效的物流单号”，弹窗提示“物流单号无效，请联系客服确认”。  


7. **用例名称：确认收货**  
   用例编号：UC-5.7  
   参与者：主参与者：已登录用户  
   触发条件：用户点击订单操作栏“确认收货”按钮（仅“已发货”状态订单显示该按钮）  
   前置条件：1. 订单状态为2（已发货）；2. 用户已收到商品（主观条件，系统不校验物流状态）  
   主要流程：  
   1. 用户点击“确认收货”按钮，系统弹出确认弹窗，提示“确认已收到商品？确认后订单将变为‘已完成’状态”，提供“确认收货”“取消”按钮；  
   2. 若用户点击“取消”：关闭弹窗，返回订单列表，无其他操作；  
   3. 若用户点击“确认收货”：系统携带“用户ID”“订单ID”调用`UpdateOrderStatus`接口，请求将订单状态更新为3（已完成）；  
   4. 接口返回结果：  
      - 成功：弹窗显示“收货确认成功”，2秒后关闭，页面刷新订单列表，该订单状态更新为“已完成”，操作按钮组更新为“查看详情”；  
      - 失败：弹窗显示“确认收货失败，请重试”（如系统异常）或“订单状态已变更，无法确认收货”（如已被商家操作）。  
   后置条件：符合条件的订单状态更新为“已完成”，订单列表同步刷新  
   异常情况：  
   - 确认收货时物流仍在运输中：系统不拦截操作，仅弹窗提示“当前物流仍在运输中，确认已收到商品？”，用户确认后继续流程；  
   - 接口超时：弹窗显示“操作超时，请稍后重试”，提供“重试”按钮，点击后重新发起状态更新请求。


### 3.6订单详情页

#### 3.6.1订单详情页数据项
| 数据项名称       | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|------------------|----------|----------|---------------------------------|------------------------------------------|
| 订单 ID          | STRING   | 是       | "uuid-20240612-12345"           | 订单唯一标识，与个人订单页订单ID关联，用于数据一致性校验 |
| 订单项列表       | 数组     | 是       | [{"itemId":"item-001","goodsId":"g-123",...}] | 订单包含的所有商品明细，每个元素为单个商品的订单项数据 |
| 订单项 ID        | STRING   | 是       | "item-001"                      | 单个商品订单项的唯一标识，用于区分同一订单内不同商品 |
| 商品 ID          | STRING   | 是       | "g-123"                         | 商品唯一标识，用于关联商品详情页（支持点击跳转） |
| 商品封面         | STRING   | 是       | "/static/img/three_kingdoms.jpg" | 商品展示图片路径，渲染订单项时展示商品外观 |
| 商品名称         | STRING   | 是       | "三国演义（精装典藏版）"        | 商品完整名称，超出长度时支持换行或省略号显示 |
| 商品规格         | STRING   | 否       | "32开/全2册"                    | 商品规格信息（如尺寸、版本、颜色等），无规格时为空 |
| 商品单价         | FLOAT    | 是       | 88.80                           | 商品购买时的实际单价（不含优惠分摊），保留两位小数 |
| 购买数量         | INT      | 是       | 2                              | 单个商品的购买数量，用于计算订单项小计 |
| 订单项小计       | FLOAT    | 是       | 177.60                         | 单个订单项的金额（商品单价×购买数量），保留两位小数 |
| 订单总金额       | FLOAT    | 是       | 187.60                         | 订单最终支付金额（订单项小计总和+运费-优惠金额），保留两位小数 |
| 商品总金额       | FLOAT    | 是       | 177.60                         | 所有订单项小计总和，不含运费和优惠 |
| 运费             | FLOAT    | 是       | 10.00                          | 订单配送费用，无运费时为0.00 |
| 优惠金额         | FLOAT    | 是       | 0.00                           | 订单享受的总优惠金额（如优惠券、满减等），无优惠时为0.00 |
| 订单状态         | INT      | 是       | 2                              | 状态枚举与个人订单页一致：0-未支付，1-已支付待发货，2-已发货，3-已完成，4-已取消，5-退款中，6-已退款 |
| 订单状态文本     | STRING   | 是       | "已发货"                        | 订单状态的文字描述，与“订单状态”一一对应，用于页面展示 |
| 订单创建时间     | STRING   | 是       | "2024-06-12 15:30:22"          | 订单生成时间，格式为“年-月-日 时:分:秒” |
| 支付时间         | STRING   | 否       | "2024-06-12 15:35:10"          | 订单支付完成时间，未支付/已取消订单该字段为空 |
| 发货时间         | STRING   | 否       | "2024-06-13 09:45:33"          | 商家发货时间，仅“已发货”“已完成”状态订单有值 |
| 完成时间         | STRING   | 否       | "2024-06-15 11:20:45"          | 订单变为“已完成”的时间（用户确认收货或系统自动确认），仅“已完成”状态订单有值 |
| 取消时间         | STRING   | 否       | "2024-06-12 16:00:21"          | 订单取消时间，仅“已取消”状态订单有值 |
| 收货人姓名       | STRING   | 是       | "张三"                          | 订单收货人姓名，用于展示完整收货信息 |
| 联系电话         | STRING   | 是       | "138****8000"                  | 收货人联系电话（隐藏中间4位），支持点击拨打（移动端） |
| 收货地址         | STRING   | 是       | "北京市朝阳区XX街道XX小区3号楼1单元501" | 完整收货地址，包含省、市、区、详细地址和邮编（如有） |
| 支付方式         | STRING   | 是       | "微信支付"                      | 订单支付渠道，如“微信支付”“支付宝”“银行卡支付” |
| 支付单号         | STRING   | 否       | "wx2024061215351000000000000001" | 第三方支付平台生成的支付单号，用于对账和问题排查，未支付订单为空 |
| 物流单号         | STRING   | 否       | "SF1234567890123"              | 订单配送单号，仅“已发货”“已完成”状态订单有值，支持点击复制 |
| 物流公司         | STRING   | 否       | "顺丰速运"                      | 配送物流公司名称，与“物流单号”配套展示，支持点击跳转至物流公司官网 |
| 物流轨迹列表     | 数组     | 否       | [{"time":"2024-06-13 10:00:00","location":"北京市","desc":"快递已发出"},...] | 物流节点记录，每个元素包含“时间”“地点”“描述”，按时间倒序排列 |
| 用户 ID          | STRING   | 是       | "user-789"                     | 当前登录用户唯一标识，用于校验订单归属权（防止越权访问） |
| 商家 ID          | STRING   | 是       | "merchant-456"                  | 订单所属商家标识，用于展示商家信息（如商家名称、客服入口） |
| 商家名称         | STRING   | 是       | "XX图书专营店"                  | 商家店铺名称，支持点击跳转至商家首页 |
| 订单备注         | STRING   | 否       | "请尽快发货，谢谢"              | 用户下单时填写的备注信息，无备注时为空 |


#### 3.6.2订单详情页功能用例分析

1. **用例名称：加载订单详情数据**  
   用例编号：UC-6.1  
   参与者：主参与者：已登录用户  
   触发条件：用户从个人订单页点击“查看详情”跳转至该页面、直接访问详情页URL、刷新详情页  
   前置条件：1. 用户已完成登录验证；2. 页面URL携带有效的订单ID参数  
   主要流程：  
   1. 系统通过`CheckUserLogin`接口验证用户登录状态，确认token有效；若未登录，跳转至登录页（携带`/order-detail?orderId=xxx`回调参数）；  
   2. 系统从URL中提取“订单ID”，检查参数是否存在：若订单ID缺失，页面显示“订单ID参数缺失，请返回个人订单页重新选择”，提供“返回我的订单”按钮；  
   3. 若订单ID存在，系统携带“用户ID”“订单ID”调用`QueryOrderDetail`接口，查询订单完整数据（含订单项、支付、物流等信息）；  
   4. 接口校验订单归属权：若订单不属于当前用户或订单不存在，页面显示“无效的订单信息，可能已被删除或不属于您”，提供“返回我的订单”按钮；  
   5. 若接口返回正常数据：页面按“订单状态区→订单基本信息区→订单项列表区→支付信息区→收货信息区→物流信息区”的顺序渲染内容；  
   6. 针对不同订单状态，页面在“订单状态区”展示对应操作指引（如“已发货”状态显示“预计XX天送达，可点击查看物流”）。  
   后置条件：用户成功查看完整的订单详情（或获取无效订单提示）  
   异常情况：  
   - 接口调用超时：页面显示“获取订单详情超时，请点击重试”，提供“重试”按钮，点击后重新发起`QueryOrderDetail`请求；  
   - 接口返回数据不完整（如缺少订单项列表）：页面显示“订单数据异常，请联系客服处理”，提供“联系客服”和“返回我的订单”按钮；  
   - 网络中断：页面显示“网络连接异常，请检查网络后重试”，支持刷新页面重新加载。  


2. **用例名称：查看订单项与商品详情**  
   用例编号：UC-6.2  
   参与者：主参与者：已登录用户  
   触发条件：用户点击订单项中的“商品名称”或“商品封面”  
   前置条件：1. 订单详情已加载完成；2. 订单项列表正常渲染  
   主要流程：  
   1. 用户点击目标订单项的“商品名称”或“商品封面”；  
   2. 系统获取该订单项的“商品ID”，生成商品详情页URL（如`/goods-detail?goodsId=g-123`）；  
   3. 系统以新页面或当前页面跳转至商品详情页；  
   4. 若商品已下架/删除：商品详情页显示“该商品已下架或不存在”，提供“返回订单详情”和“去首页购物”按钮。  
   后置条件：用户成功跳转至对应商品的详情页（或获取商品下架提示）  
   异常情况：  
   - 商品ID传递错误：商品详情页显示“无效的商品ID”，提供“返回订单详情”按钮；  
   - 跳转时网络异常：页面停留在订单详情页，显示“跳转失败，请检查网络”。  


3. **用例名称：查看完整物流轨迹**  
   用例编号：UC-6.3  
   参与者：主参与者：已登录用户  
   触发条件：用户点击“物流信息区”的“查看完整轨迹”按钮（仅“已发货”“已完成”状态订单显示）  
   前置条件：1. 订单状态为2（已发货）或3（已完成）；2. 系统已获取“物流单号”“物流公司”及物流轨迹数据  
   主要流程：  
   1. 用户点击“查看完整轨迹”按钮，系统弹出物流轨迹弹窗；  
   2. 弹窗顶部展示“物流公司：XX”“物流单号：XXX”及“复制”按钮，中部按“时间倒序”渲染物流轨迹列表（最新轨迹置顶）；  
   3. 每条轨迹记录显示“时间”（如“2024-06-13 10:00:00”）、“地点”（如“北京市”）、“描述”（如“快递已发出，正在前往下一站”），最新轨迹用特殊图标（如绿色对勾）标记；  
   4. 用户点击“复制”按钮：系统将物流单号复制到剪贴板，弹窗提示“物流单号已复制”（2秒后自动消失）；  
   5. 用户点击“前往物流公司官网查询”链接：系统以新页面打开物流公司官网查询页（携带物流单号）；  
   6. 用户点击弹窗“关闭”按钮或外部空白区域：弹窗关闭，返回订单详情页。  
   后置条件：用户成功查看完整物流轨迹（或获取轨迹未更新提示）  
   异常情况：  
   - 物流轨迹数据为空：弹窗显示“物流信息暂未更新，请稍后查询”，提供“刷新”按钮，点击后重新调用`QueryLogisticsTrack`接口；  
   - 复制功能失败（如浏览器权限限制）：弹窗提示“复制失败，请手动复制物流单号”；  
   - 物流公司官网链接无效：跳转至浏览器404页面，页面保留弹窗可关闭。  


4. **用例名称：订单详情页操作按钮（取消/确认收货/申请退款）**  
   用例编号：UC-6.4  
   参与者：主参与者：已登录用户  
   触发条件：用户点击页面“订单状态区”的操作按钮（按钮显示逻辑：未支付→“取消订单”；已支付待发货→“取消订单”“申请退款”；已发货→“确认收货”“申请退款”；已完成→“申请售后”；已取消/退款中/已退款→无操作按钮）  
   前置条件：1. 订单详情已加载完成；2. 订单状态符合操作按钮显示条件  
   主要流程：  
   - **子流程1：取消订单**（仅“未支付”“已支付待发货”状态）：  
     1. 用户点击“取消订单”按钮，系统弹出确认弹窗，提示“取消订单后将无法恢复，是否确认？未支付订单取消后可重新下单，已支付订单取消后将发起退款（1-3个工作日到账）”；  
     2. 若用户点击“取消”：关闭弹窗，返回订单详情页；  
     3. 若用户点击“确认取消”：系统携带“用户ID”“订单ID”调用`UpdateOrderStatus`接口，请求将状态更新为4（已取消）；  
     4. 接口返回成功：弹窗显示“订单取消成功”（已支付订单额外提示“退款已发起，请注意查收”），2秒后关闭弹窗，页面重新加载订单详情（状态更新为“已取消”，操作按钮隐藏）；  
     5. 接口返回失败：弹窗显示“取消订单失败，原因：XXX”（如“当前订单已发货，无法取消”），提供“重试”和“关闭”按钮。  

   - **子流程2：确认收货**（仅“已发货”状态）：  
     1. 用户点击“确认收货”按钮，系统弹出确认弹窗，提示“请确认已收到商品，确认后订单将变为‘已完成’状态，若未收到商品请先联系客服或查看物流”；  
     2. 若用户点击“取消”：关闭弹窗，返回订单详情页；  
     3. 若用户点击“确认收货”：系统携带“用户ID”“订单ID”调用`UpdateOrderStatus`接口，请求将状态更新为3（已完成）；  
     4. 接口返回成功：弹窗显示“收货确认成功”，2秒后关闭弹窗，页面重新加载订单详情（状态更新为“已完成”，操作按钮变为“申请售后”）；  
     5. 接口返回失败：弹窗显示“确认收货失败，请重试”，提供“重试”按钮。  

   - **子流程3：申请退款/售后**（“已支付待发货”→“申请退款”；“已发货”“已完成”→“申请售后”）：  
     1. 用户点击“申请退款”/“申请售后”按钮，系统跳转至“退款售后申请页”，并携带“订单ID”“订单项ID”参数；  
     2. 退款售后申请页加载后，自动调用`QueryOrderRefundInfo`接口，获取订单可退款金额、订单项等信息；  
     3. 用户按页面指引填写退款原因、金额、上传凭证（如有），提交退款申请；  
     4. 若申请提交成功：跳转回订单详情页，显示“退款申请已提交，商家将在XX小时内处理”，订单状态更新为5（退款中）；  
     5. 若申请提交失败：退款售后申请页显示“申请提交失败，请重试”，提供“重试”按钮。  

   后置条件：用户完成对应操作（取消订单/确认收货/提交退款申请），订单状态同步更新，页面重新渲染  
   异常情况：  
   - 操作时订单状态已变更（如用户点击“取消”时商家已发货）：接口返回“订单状态已更新，当前操作不可用”，弹窗提示用户刷新页面；  
   - 接口调用超时：弹窗显示“操作超时，请稍后重试”，提供“重试”按钮。  


5. **用例名称：返回个人订单页**  
   用例编号：UC-6.5  
   参与者：主参与者：已登录用户  
   触发条件：用户点击页面顶部“返回我的订单”按钮、面包屑导航“我的订单”选项  
   前置条件：1. 订单详情页已加载（无论是否为有效订单）；2. 用户已登录  
   主要流程：  
   1. 用户点击“返回我的订单”按钮或面包屑“我的订单”；  
   2. 系统记录个人订单页的“最后筛选状态”“最后页码”（如状态筛选=2、页码=1）；  
   3. 系统跳转至个人订单页（URL：`/my-orders?status=2&page=1`），并自动加载对应筛选状态和页码的订单列表；  
   4. 若未记录历史筛选状态和页码：默认跳转至“全部”状态、第1页的个人订单页。  
   后置条件：用户成功返回个人订单页，查看历史筛选状态的订单列表  
   异常情况：  
   - 跳转时用户登录状态失效：自动跳转至登录页，携带回调参数，登录后返回个人订单页；  
   - 历史筛选状态参数无效：默认按“全部”状态加载第1页订单。


## 3.7 管理员首页模块需求说明
### 3.7.1 管理员首页页面数据项
| 数据项名称         | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|--------------------|----------|----------|---------------------------------|------------------------------------------|
| 图书总数           | INT      | 是       | 200                             | 系统中所有图书的总数量，从数据库统计得出 |
| 待发货订单数       | INT      | 是       | 15                              | 状态为“未发货”的订单总数量               |
| 今日新增用户数     | INT      | 是       | 8                               | 当天注册的用户总数量                     |
| 本周销售额         | FLOAT    | 是       | 5000.50                         | 本周累计销售总金额，保留两位小数         |
| 热门图书TOP3列表   | 数组     | 是       | [{"id":101,"title":"三体"},...] | 按销量排序的前三名图书信息，含ID、名称、销量 |
| 管理员登录状态     | BOOLEAN  | 是       | true                           | 标识管理员是否登录（true为已登录，false为未登录），控制页面访问权限 |
| 会话有效期         | INT      | 是       | 30                              | 管理员登录会话的有效时长（分钟），超时自动退出 |
| 最近登录时间       | STRING   | 是       | "2024-06-12 09:30:25"          | 管理员上次登录的时间，用于安全提示       |
| 系统当前时间       | STRING   | 是       | "2024-06-12 15:45:30"          | 服务器当前时间，用于数据时效性展示       |
| 操作日志条数       | INT      | 否       | 23                              | 今日管理员操作日志的总条数，可选展示     |

### 3.7.2 管理员首页功能用例分析

1. **用例名称：管理员权限验证**  
   用例编号：UC-7.1  
   参与者：主参与者：管理员；次要参与者：普通用户、未登录用户  
   触发条件：用户访问管理员首页  
   前置条件：系统已配置管理员角色权限  
   主要流程：  
   1. 系统接收管理员首页访问请求；  
   2. 调用`IsLogin`接口验证用户登录状态及角色（`role=admin`）；  
   3. 若为管理员且已登录：允许访问并加载页面数据；  
   4. 若为普通用户或未登录：自动跳转至登录页并提示“权限不足，请使用管理员账号登录”。  
   后置条件：管理员成功访问首页，非管理员被拒绝访问  
   异常情况：  
   - 会话验证失败（如Session过期）：跳转至登录页并提示“登录已过期，请重新登录”；  
   - 角色信息异常（如角色字段为空）：记录错误日志并拒绝访问。  


2. **用例名称：核心数据概览展示**  
   用例编号：UC-7.2  
   参与者：主参与者：管理员  
   触发条件：管理员成功访问首页或页面定时刷新  
   前置条件：管理员已登录且权限验证通过  
   主要流程：  
   1. 系统调用统计接口（如`/getAdminStats`）查询图书总数、待发货订单数、今日新增用户数、本周销售额等核心数据；  
   2. 页面以卡片形式展示各类数据，不同数据对应不同颜色标识（如销售额用绿色，待发货订单用橙色）；  
   3. 热门图书TOP3以列表形式展示，包含图书封面缩略图、名称及销量；  
   4. 每30秒自动重新请求接口刷新数据，更新时显示淡入动画提示“数据已更新”。  
   后置条件：管理员实时查看系统核心数据  
   异常情况：  
   - 数据查询失败：卡片显示“--”代替具体数值，并提示“数据加载失败，请刷新重试”；  
   - 热门图书数据为空：显示“暂无热门图书数据”。  


3. **用例名称：快捷功能入口跳转**  
   用例编号：UC-7.3  
   参与者：主参与者：管理员  
   触发条件：管理员点击“添加新图书”“查看待发货订单”等快捷按钮  
   前置条件：管理员已登录首页  
   主要流程：  
   1. 管理员点击“添加新图书”按钮：系统跳转至图书编辑页（`/toUpdateBookPage`）；  
   2. 管理员点击“查看待发货订单”按钮：系统跳转至订单管理页并默认筛选“未发货”状态（`/getOrders?status=未发货`）；  
   3. 管理员点击“热门图书详情”按钮：跳转至图书管理页并筛选对应图书（`/getPageBooks?keyword=xxx`）；  
   4. 管理员点击顶部导航的“图书管理”“订单管理”：跳转至对应页面并高亮当前页链接。  
   后置条件：管理员成功跳转至目标功能页  
   异常情况：  
   - 目标页面不存在：显示“页面不存在”错误页；  
   - 跳转参数错误（如图书ID无效）：跳转至目标页首页并提示“参数错误”。  


4. **用例名称：防频繁操作限制**  
   用例编号：UC-7.4  
   参与者：主参与者：管理员  
   触发条件：管理员短时间内频繁刷新页面或提交操作  
   前置条件：管理员已登录首页  
   主要流程：  
   1. 系统记录5分钟内的页面刷新及按钮点击次数；  
   2. 当操作次数超过10次/分钟时：临时禁止操作30秒并提示“操作过于频繁，请30秒后再试”；  
   3. 限制时间内再次操作：延长限制时间至1分钟；  
   4. 限制时间结束后，恢复正常访问权限并重置计数。  
   后置条件：有效防止恶意刷新或重复提交行为  
   异常情况：  
   - 操作次数统计异常（如缓存失效）：默认关闭限制，仅在日志中记录警告。  


5. **用例名称：登录信息展示与安全提示**  
   用例编号：UC-7.5  
   参与者：主参与者：管理员  
   触发条件：管理员成功登录首页  
   前置条件：管理员登录状态有效  
   主要流程：  
   1. 页面顶部显示管理员用户名及最近登录时间（如“欢迎 admin，上次登录时间：2024-06-11 16:20:10”）；  
   2. 若最近登录IP与当前IP不一致：提示“检测到异地登录，请注意账号安全”；  
   3. 会话剩余有效期小于5分钟时：弹窗提示“您的登录即将过期，是否延长会话？”，点击“是”则延长有效期30分钟。  
   后置条件：管理员获取登录相关信息及安全提示  
   异常情况：  
   - 最近登录记录查询失败：隐藏最近登录时间，仅显示欢迎信息。  


## 3.8 登录注册页模块需求说明
### 3.8.1 登录注册页页面数据项
| 数据项名称         | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|--------------------|----------|----------|---------------------------------|------------------------------------------|
| 用户名             | STRING   | 是       | "user123"                       | 用户登录/注册的账号，唯一标识，长度6-20位，支持字母、数字、下划线 |
| 密码               | STRING   | 是       | "pwd@123456"                    | 用户密码（存储时经MD5加密），长度8-20位，需包含字母、数字及特殊字符 |
| 确认密码           | STRING   | 是（注册）| "pwd@123456"                    | 注册时需与密码一致，用于校验输入准确性   |
| 电子邮箱           | STRING   | 是（注册）| "user@example.com"              | 用户注册邮箱，用于身份验证或找回密码，需符合邮箱格式 |
| 验证码             | STRING   | 是       | "8A3F"                          | 图形验证码，区分大小写，有效时长5分钟     |
| 记住登录状态       | BOOLEAN  | 否       | true                           | 登录时勾选，Cookie有效期设为7天，未勾选则为2小时 |
| 登录失败次数       | INT      | 是       | 3                               | 记录连续登录失败次数，超过5次则锁定账号1小时 |
| 用户名验证结果     | STRING   | 是（注册）| "用户名可用"                    | 实时验证用户名是否已存在，可选值：“用户名可用”“用户名已存在”“用户名格式错误” |
| 注册IP地址         | STRING   | 是       | "192.168.1.1"                   | 记录注册时的IP，用于限制批量注册         |
| 协议同意状态       | BOOLEAN  | 是（注册）| true                           | 注册时需勾选“同意用户协议”，否则无法提交 |

### 3.8.2 登录注册页功能用例分析

1. **用例名称：用户登录**  
   用例编号：UC-8.1  
   参与者：主参与者：用户  
   触发条件：用户输入用户名、密码、验证码并点击“登录”按钮  
   前置条件：用户已进入登录页  
   主要流程：  
   1. 前端验证：  
      - 检查用户名/密码/验证码是否为空，为空则提示“请完善登录信息”；  
      - 验证验证码是否正确，错误则提示“验证码错误”并刷新验证码；  
   2. 提交表单至`/login`接口，后端验证用户名、密码及账号状态；  
   3. 验证通过：  
      - 普通用户：创建Session，若勾选“记住登录状态”则设置长效Cookie，跳转至商城首页（`/main`），显示“登录成功，欢迎回来”；  
      - 管理员：创建Session，跳转至管理员首页，显示“管理员登录成功”；  
   4. 验证失败：  
      - 用户名或密码错误：页面显示“用户名或密码不正确”，登录失败次数+1，保留用户名输入；  
      - 账号被锁定：提示“账号已被锁定，请1小时后再试”。  
   后置条件：用户成功登录或获取明确的失败原因  
   异常情况：  
   - 数据库连接失败：提示“登录异常，请稍后重试”；  
   - Session创建失败：登录成功后跳转至首页但未保持登录状态，提示“登录状态异常”。  


2. **用例名称：用户注册**  
   用例编号：UC-8.2  
   参与者：主参与者：新用户  
   触发条件：用户填写注册信息并点击“注册”按钮  
   前置条件：用户已进入注册页  
   主要流程：  
   1. 前端实时验证：  
      - 用户名：输入时检测格式及唯一性，不符合则实时提示（如“用户名长度需6-20位”）；  
      - 密码：检测格式，不符合则提示（如“密码需包含字母、数字和特殊字符”）；  
      - 确认密码：与密码不一致时提示“两次输入的密码不一致”；  
      - 邮箱：检测格式，不符合则提示“请输入有效的邮箱地址”；  
   2. 用户勾选“同意用户协议”并点击“注册”，前端再次校验所有字段；  
   3. 提交表单至`/regist`接口，后端执行：  
      - 再次验证用户名唯一性（防并发注册）；  
      - 对密码进行MD5加密后存储；  
      - 记录注册IP及时间；  
   4. 注册成功：跳转至登录页，提示“注册成功，请登录”；  
   5. 注册失败：根据错误类型提示（如“邮箱已被注册”“IP今日注册次数超限”）。  
   后置条件：新用户成功注册或获取明确的失败原因  
   异常情况：  
   - 注册过程中网络中断：页面保留已填信息，提示“网络异常，请重试”；  
   - 邮箱格式正确但无法接收邮件（非必填流程）：不影响注册，仅提示“验证邮件发送失败，可正常登录”。  


3. **用例名称：验证码生成与验证**  
   用例编号：UC-8.3  
   参与者：主参与者：用户  
   触发条件：用户加载登录/注册页或点击“刷新验证码”  
   前置条件：页面已加载完成  
   主要流程：  
   1. 页面加载时，系统调用`/getCaptcha`接口生成随机验证码（4位字母数字组合）；  
   2. 接口返回验证码图片（含干扰线、噪点）及对应的唯一标识（用于后端校验）；  
   3. 用户点击“刷新验证码”：重新调用接口生成新验证码；  
   4. 用户提交登录/注册表单时，前端将用户输入的验证码与标识一同提交；  
   5. 后端根据标识查询存储的验证码，验证一致性。  
   后置条件：用户获取有效验证码并完成验证  
   异常情况：  
   - 验证码生成失败：显示默认图片并提示“验证码加载失败”；  
   - 验证码过期（超过5分钟）：提示“验证码已过期，请刷新”。  


4. **用例名称：密码强度检测**  
   用例编号：UC-8.4  
   参与者：主参与者：注册用户  
   触发条件：用户在注册页输入密码  
   前置条件：用户进入注册流程  
   主要流程：  
   1. 用户输入密码时，前端实时检测密码复杂度：  
      - 弱：仅包含字母或数字（如“123456”“abcdef”），显示红色进度条及“密码强度：弱”；  
      - 中：包含字母和数字（如“abc123”），显示黄色进度条及“密码强度：中”；  
      - 强：包含字母、数字和特殊字符（如“abc@123”），显示绿色进度条及“密码强度：强”；  
   2. 若密码强度为“弱”：提示“建议使用更强的密码（包含字母、数字和特殊字符）”；  
   3. 仅当密码强度为“中”或“强”时，允许提交注册表单。  
   后置条件：用户明确密码强度并输入符合要求的密码  
   异常情况：  
   - 检测逻辑异常：默认允许提交，但后端再次校验，不符合则返回“密码强度不足”。  


## 3.9 结账页模块需求说明
### 3.9.1 结账页页面数据项
| 数据项名称         | 数据类型 | 是否必填 | 示例值                          | 说明                                     |
|--------------------|----------|----------|---------------------------------|------------------------------------------|
| 购物车ID           | STRING   | 是       | "cart_123456"                   | 用户购物车唯一标识，用于关联购物项       |
| 购物项列表         | 数组     | 是       | [{"bookId":101,"title":"三体",...},...] | 待结算的图书信息，含图书ID、名称、封面、单价、数量、小计金额 |
| 商品总数量         | INT      | 是       | 3                               | 所有购物项的数量总和                     |
| 商品总金额         | FLOAT    | 是       | 256.50                          | 所有购物项的金额总和，保留两位小数       |
| 收货地址列表       | 数组     | 是       | [{"addrId":5,"name":"张三",...},...] | 用户保存的收货地址，含地址ID、收件人、电话、详细地址、是否默认 |
| 选中的地址ID       | INT      | 是       | 5                               | 用户当前选中的收货地址ID，用于生成订单   |
| 支付方式列表       | 数组     | 是       | ["微信支付","支付宝","银行卡"]  | 支持的支付方式选项                       |
| 选中的支付方式     | STRING   | 是       | "微信支付"                      | 用户选择的支付方式                       |
| 订单备注           | STRING   | 否       | "请在工作日送货"                | 用户填写的订单附加说明，长度不超过200字  |
| 优惠券列表         | 数组     | 否       | [{"couponId":3,"discount":10,...},...] | 用户可用的优惠券，含券ID、折扣金额、使用门槛 |
| 实付金额           | FLOAT    | 是       | 246.50                          | 总金额减去优惠券折扣后的金额，保留两位小数 |
| 用户ID             | INT      | 是       | 789                             | 当前登录用户的唯一标识，用于关联订单     |

### 3.9.2 结账页功能用例分析

1. **用例名称：购物车数据加载与展示**  
   用例编号：UC-9.1  
   参与者：主参与者：已登录用户  
   触发条件：用户点击购物车中的“去结账”按钮  
   前置条件：用户购物车中存在商品且已登录  
   主要流程：  
   1. 系统调用`/getCartInfo`接口获取用户购物车中的所有商品；  
   2. 页面渲染购物项列表，展示每本图书的封面、名称、单价、数量及小计金额；  
   3. 自动计算并显示商品总数量和总金额；  
   4. 若购物项中存在库存不足的商品（如当前库存 < 购物车数量）：  
      - 高亮显示该商品并提示“库存不足，当前可购XX本”；  
      - 提供“调整数量”按钮允许修改，或“移除”按钮删除该商品。  
   后置条件：用户清晰查看待结算的购物车数据  
   异常情况：  
   - 购物车数据查询失败：提示“购物车数据加载失败，请返回重试”；  
   - 购物车为空：自动跳转回购物车页面并提示“购物车为空，无法结账”。  


2. **用例名称：收货地址管理**  
   用例编号：UC-9.2  
   参与者：主参与者：已登录用户  
   触发条件：用户在结账页选择或添加收货地址  
   前置条件：用户已进入结账页  
   主要流程：  
   1. 系统调用`/getUserAddresses`接口获取用户保存的所有收货地址；  
   2. 页面展示地址列表，默认选中用户的默认地址（若存在）；  
   3. 用户点击其他地址：更新选中状态，后续订单将使用该地址；  
   4. 用户点击“添加新地址”：  
      - 弹出地址表单（含收件人、电话、省市区、详细地址字段）；  
      - 提交后调用`/addAddress`接口保存，成功后刷新地址列表并选中新地址。  
   后置条件：用户成功选择或添加收货地址  
   异常情况：  
   - 地址查询失败：提示“地址加载失败”，但允许继续添加新地址；  
   - 新增地址格式错误（如电话位数不对）：提示“请输入有效的联系方式”。  


3. **用例名称：支付方式选择**  
   用例编号：UC-9.3  
   参与者：主参与者：已登录用户  
   触发条件：用户在结账页选择支付方式  
   前置条件：用户已加载结账页且购物车数据有效  
   主要流程：  
   1. 页面展示支持的支付方式列表（如微信支付、支付宝）；  
   2. 用户点击某支付方式：选中状态切换，记录用户选择；  
   3. 若选择“银行卡支付”：额外显示银行卡号输入框（带格式校验）；  
   4. 提交订单时，将选中的支付方式传入订单数据。  
   后置条件：用户成功选择支付方式  
   异常情况：  
   - 支付方式列表加载失败：默认选中“微信支付”并提示“支付方式加载异常，默认使用微信支付”。  


4. **用例名称：订单提交与生成**  
   用例编号：UC-9.4  
   参与者：主参与者：已登录用户  
   触发条件：用户点击“提交订单”按钮  
   前置条件：用户已完成地址选择、支付方式选择，购物车数据有效  
   主要流程：  
   1. 前端校验：  
      - 检查是否选中收货地址，未选中则提示“请选择收货地址”；  
      - 检查是否选择支付方式，未选择则提示“请选择支付方式”；  
   2. 调用`/checkout`接口提交订单数据（含购物车ID、地址ID、支付方式、备注等）；  
   3. 后端执行：  
      - 再次校验库存（防并发超卖）；  
      - 生成唯一订单号，创建订单记录；  
      - 扣减对应图书库存，清空购物车或移除已结算商品；  
   4. 提交成功：跳转至支付页，携带订单号及实付金额；  
   5. 提交失败：根据错误提示（如“部分商品已售罄”），允许用户调整后重新提交。  
   后置条件：订单成功生成或获取明确的失败原因  
   异常情况：  
   - 提交过程中网络中断：提示“提交失败，请检查网络”，允许重试（需防重复下单）；  
   - 库存校验失败：返回“商品《XXX》库存不足”，并刷新购物车数据。  


5. **用例名称：优惠券使用**  
   用例编号：UC-9.5  
   参与者：主参与者：已登录用户  
   触发条件：用户在结账页选择优惠券  
   前置条件：用户有可用优惠券且总金额满足使用门槛  
   主要流程：  
   1. 系统调用`/getUserCoupons`接口获取用户可用优惠券；  
   2. 页面展示优惠券列表，标注每张券的折扣金额及使用门槛（如“满100减10”）；  
   3. 用户选择某优惠券：  
      - 若满足使用门槛（总金额 ≥ 门槛）：实付金额 = 总金额 - 折扣金额，页面实时更新；  
      - 若不满足：提示“订单金额未达到使用门槛”，无法选中；  
   4. 用户取消选择：实付金额恢复为总金额。  
   后置条件：用户成功使用或取消优惠券  
   异常情况：  
   - 优惠券列表加载失败：提示“优惠券加载失败，可正常提交订单”，不影响结账流程。
