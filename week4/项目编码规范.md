# 项目编码规范

## 首部

### attributes

- **项目名称**: Go语言书城项目

- **项目标识**: GOBOOKSTORE-2025-001

- **版本**: V1.0

### 状态与版本信息

- **文件状态**: 草稿

- **文件标识**: SC-GOBOOKSTORE-V1.0-coding_standards

- **当前版本**: V1.0

- **作者**:
  
  - **姓名**: 谢毓民
  
  - **学号**: 2022011142
  
  - **姓名**: 贾维峰
  
  - **学号**: 2022011144
  
  - **姓名**: 仇海鑫
  
  - **学号**: 2022011143
  
  - **团队**: 404回收站

- **完成日期**: 2025年10月18日

- **版本更新信息**: 首次创建

### 引言

- **使用人员**: 本编码规范文档主要面向参与Go语言书城项目开发的全体开发人员，包括后端开发工程师、前端开发工程师以及与代码编写相关的测试人员等，旨在为他们提供统一的代码编写标准和参考依据，确保项目的代码质量和可维护性。

- **编写目的**: 为了规范Go语言书城项目开发过程中的代码编写风格，提高代码的可读性、可维护性和一致性，降低团队协作中因代码风格差异带来的沟通成本和潜在问题，特制定本编码规范文档。通过遵循本规范，能够有效提升项目的整体质量，便于后续的代码审查、测试、维护和扩展等工作顺利开展。

- **背景**: 随着互联网技术的不断发展，电子书市场呈现出蓬勃发展的态势。为了满足用户在线阅读和购买图书的需求，我们启动了Go语言书城项目。该项目采用Go语言进行开发，利用其高效、并发能力强等优势，构建一个功能完善、性能卓越的在线图书商城应用系统。在项目开发过程中，代码质量是至关重要的因素之一，而一套统一且严格的编码规范则是保障代码质量的关键。因此，我们依据Go语言的官方规范以及项目自身的技术架构和业务需求，制定了本编码规范文档，以指导项目开发工作。

- **定义与缩写**:

  - **业务术语**:

    - **书城系统**: 基于Go语言开发的在线图书商城应用系统，包含前端界面、后端服务、数据库等完整组成部分，为用户提供图书浏览、搜索、购买、阅读等功能，同时支持用户管理、订单管理、图书管理等后台运营管理功能。

    - **图书**:在书城系统中，指可供用户浏览、购买和阅读的各种电子书籍，具有书名、作者、出版社、出版日期、价格、简介、分类等属性信息。

    - **用户**:指在书城系统中注册并使用相关功能的个人或团体，拥有个人账户信息，可进行图书购买、阅读、收藏、评论等操作。

    - **订单**:用户在书城系统中购买图书时生成的交易记录，包含订单编号、用户信息、购买图书信息、订单金额、支付状态、发货状态、订单创建时间等详细信息。

---

### 1. 项目概述

本项目是一个基于Go语言开发的Web书店系统，采用MVC架构模式，包含用户管理、图书管理、购物车、订单管理等功能模块。

### 2. 项目结构规范

#### 2.1 目录结构
```
bookstore0612/
├── controller/     # 控制器层 - 处理HTTP请求
├── dao/           # 数据访问层 - 数据库操作
├── model/         # 模型层 - 数据结构定义
├── utils/         # 工具包 - 通用功能
├── views/         # 视图层 - HTML模板和静态资源
│   ├── pages/     # 页面模板
│   └── static/    # 静态资源(CSS, JS, 图片)
├── main.go        # 程序入口
└── sql.sql        # 数据库脚本
```

#### 2.2 包命名规范

- 包名使用小写字母，简洁明了

- 避免使用下划线或混合大小写

- 包名应该反映其功能：`controller`、`dao`、`model`、`utils`

### 3. 代码风格规范

#### 3.1 文件命名规范

- Go源文件使用小写字母和下划线：`userhandler.go`、`bookdao.go`
 
- HTML模板文件使用下划线分隔：`login_success.html`、`book_manager.html`

- 静态资源文件保持原有命名：`style.css`、`jquery-1.7.2.js`

#### 3.2 函数命名规范

- 函数名使用驼峰命名法，首字母大写表示公开函数

- 函数名应该清晰表达其功能：

  ```go
  
  // 好的命名
  func GetPageBooksByPrice(w http.ResponseWriter, r *http.Request)
  func CheckUserNameAndPassword(username string, password string)
  func AddBook2Cart(w http.ResponseWriter, r *http.Request)
  
  // 避免的命名
  func getBooks()  // 首字母小写，不公开
  func handle()    // 名称不明确
  
  ```

#### 3.3 变量命名规范

- 使用驼峰命名法

- 变量名应该具有描述性：

  ```go
  
  // 好的命名
  var totalRecord int64
  var pageSize int64 = 4
  var minPrice string
  var maxPrice string
  
  // 避免的命名
  var i int64
  var s string
  var temp float64
  
  ```

#### 3.4 结构体命名规范

- 结构体名使用驼峰命名法，首字母大写

- 结构体字段名使用驼峰命名法，首字母大写表示公开字段：

  ```go
  
  type User struct {
      ID       int
      Username string
      Password string
      Email    string
  }
  
  type Book struct {
      ID      int
      Title   string
      Author  string
      Price   float64
      Sales   int
      Stock   int
      ImgPath string
  }
  
  ```

### 4. 注释规范

#### 4.1 包注释

每个包都应该有简洁的包注释，说明包的功能：

```go

package model

//User 结构体
type User struct {
    // 字段定义...
}

```

#### 4.2 函数注释

公开函数必须有注释，说明函数的功能：

```go

//CheckUserNameAndPassword 根据用户名和密码从数据库中查询一条记录
func CheckUserNameAndPassword(username string, password string) (*model.User, error) {
    // 函数实现...
}

//GetPageBooksByPrice 获取带分页和价格范围的图书
func GetPageBooksByPrice(w http.ResponseWriter, r *http.Request) {
    // 函数实现...
}

```

#### 4.3 代码注释

关键业务逻辑需要添加注释说明：

```go

//判断是否已经登录
flag, _ := dao.IsLogin(r)
if flag {
    //已经登录
    //去首页
    GetPageBooksByPrice(w, r)
} else {
    //获取用户名和密码
    username := r.PostFormValue("username")
    password := r.PostFormValue("password")
    //调用userdao中验证用户名和密码的方法
    user, _ := dao.CheckUserNameAndPassword(username, password)
}

```

### 5. 错误处理规范

#### 5.1 错误返回值

函数应该返回错误信息，调用者需要处理错误：

```go

func SaveUser(username string, password string, email string) error {
    sqlStr := "insert into users(username,password,email) values(?,?,?)"
    _, err := utils.Db.Exec(sqlStr, username, password, email)
    if err != nil {
        return err
    }
    return nil
}

```

#### 5.2 错误处理模式

使用标准的Go错误处理模式：

```go

// 检查错误
if err != nil {
    return nil, err
}

// 忽略错误（仅在确定安全的情况下）
user, _ := dao.CheckUserNameAndPassword(username, password)

```

### 6. 数据库操作规范

#### 6.1 SQL语句规范

- SQL关键字使用大写：`SELECT`、`INSERT`、`UPDATE`、`DELETE`

- 使用参数化查询防止SQL注入：

  ```go
  
  sqlStr := "select id,username,password,email from users where username = ? and password = ?"
  row := utils.Db.QueryRow(sqlStr, username, password)
  
  ```

#### 6.2 数据库连接

使用全局数据库连接对象：

```go

var (
    Db  *sql.DB
    err error
)

func init() {
    Db, err = sql.Open("mysql", "root:root@tcp(localhost:3306)/bookstore0612")
    if err != nil {
        panic(err.Error())
    }
}

```

## 7. HTTP处理规范

### 7.1 路由注册

在main.go中统一注册路由：

```go

func main() {
    //设置处理静态资源，如css和js文件
    http.Handle("/static/", http.StripPrefix("/static/", http.FileServer(http.Dir("views/static"))))
    
    //去首页
    http.HandleFunc("/main", controller.GetPageBooksByPrice)
    //去登录
    http.HandleFunc("/login", controller.Login)
    //去注销
    http.HandleFunc("/logout", controller.Logout)
    
    http.ListenAndServe(":8080", nil)
}

```

### 7.2 处理器函数规范

处理器函数应该：

- 接收`http.ResponseWriter`和`*http.Request`参数

- 处理请求参数

- 调用相应的业务逻辑

- 返回响应：

  ```go
  
  func Login(w http.ResponseWriter, r *http.Request) {
      // 获取请求参数
      username := r.PostFormValue("username")
      password := r.PostFormValue("password")
      
      // 调用业务逻辑
      user, _ := dao.CheckUserNameAndPassword(username, password)
      
      // 处理响应
      if user.ID > 0 {
          // 登录成功
          t := template.Must(template.ParseFiles("views/pages/user/login_success.html"))
          t.Execute(w, user)
      } else {
          // 登录失败
          t := template.Must(template.ParseFiles("views/pages/user/login.html"))
          t.Execute(w, "用户名或密码不正确！")
      }
  }
  
  ```

## 8. 模板使用规范

### 8.1 模板解析

使用`template.Must`确保模板解析成功：

```go

t := template.Must(template.ParseFiles("views/pages/user/login_success.html"))
t.Execute(w, user)

```

### 8.2 模板路径

模板文件路径应该相对于项目根目录：

```go

// 正确的路径
"views/pages/user/login.html"
"views/index.html"

// 避免硬编码路径
"/home/user/project/views/pages/user/login.html"

```

## 9. 导入规范

### 9.1 导入顺序


按照标准库、第三方库、本地包的顺序导入：
```go
import (
    "bookstore0612/controller"
    "bookstore0612/dao"
    "bookstore0612/model"
    "bookstore0612/utils"
    "html/template"
    "net/http"
    "strconv"
)
```


### 9.2 导入分组


使用空行分隔不同组的导入：
```go
import (
    // 标准库
    "html/template"
    "net/http"
    "strconv"
    
    // 第三方库
    "encoding/json"
    "fmt"
    
    // 本地包
    "bookstore0612/controller"
    "bookstore0612/dao"
    "bookstore0612/model"
    "bookstore0612/utils"
)
```


## 10. 代码组织规范


### 10.1 函数长度


- 单个函数不宜过长，建议不超过50行
  
- 复杂逻辑应该拆分为多个小函数


### 10.2 代码复用


- 提取公共功能到utils包
  
- 避免重复代码
  
- 使用结构体方法封装相关操作：
  ```go
  //GetTotalCount 获取购物车中图书的总数量
  func (cart *Cart) GetTotalCount() int64 {
      var totalCount int64
      for _, v := range cart.CartItems {
          totalCount = totalCount + v.Count
      }
      return totalCount
  }
  ```


## 11. 安全规范


### 11.1 输入验证


- 验证用户输入
  
- 使用参数化查询防止SQL注入
  
- 对敏感数据进行适当处理


### 11.2 会话管理


- 使用Cookie和Session管理用户状态
- 设置适当的Cookie属性：
  ```go
  cookie := http.Cookie{
      Name:     "user",
      Value:    uuid,
      HttpOnly: true,
  }
  ```


## 12. 性能优化规范


### 12.1 数据库查询


- 使用分页查询避免一次性加载大量数据
  
- 合理使用索引
  
- 避免N+1查询问题


### 12.2 内存管理


- 及时关闭数据库连接
  
- 避免内存泄漏
  
- 合理使用指针和值类型


## 13. 测试规范


### 13.1 单元测试


- 为关键函数编写单元测试

  
- 测试文件以`_test.go`结尾

  
- 测试函数以`Test`开头


### 13.2 测试命名


```go
func TestCheckUserNameAndPassword(t *testing.T) {
    // 测试实现
}
```


## 14. 版本控制规范


### 14.1 提交信息


- 使用清晰的提交信息


- 说明修改的内容和原因

  
- 遵循约定式提交规范


### 14.2 分支管理


- 使用功能分支开发新功能

  
- 及时合并代码

  
- 保持主分支稳定


## 15. 部署规范


### 15.1 环境配置


- 使用配置文件管理不同环境

  
- 敏感信息不要硬编码

  
- 提供环境变量支持


### 15.2 日志记录


- 记录关键操作日志


- 使用适当的日志级别


- 便于问题排查和监控

